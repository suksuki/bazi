# V5.4 Quantum Simulation & Flux Engine Specification

## 1. Overview
This document specifies the architecture and implementation details of the V5.4 "Quantum Flux Furnace" and "Quantum Simulation" modules. These modules represent a paradigm shift from deterministic scoring to probabilistic quantum modeling in Bazi prediction.

## 2. Core Philosophy
The system treats Bazi elements not as static labels but as **Quantum States** with wave-particle duality.
- **Particle State**: The concrete manifestation (Stem/Branch) in the chart.
- **Wave State**: The probability cloud of energy distribution (Ten Gods).
- **Superposition**: Life aspects (Wealth, Career) are superposition states of multiple Ten Gods.
- **Measurement**: Observing the chart (injecting Time) collapses the wavefunction into a probability distribution (Life Aspect Curve).

## 3. Flux Engine (The Physics Layer)
The `FluxEngine` determines the raw energy state of the system based on physical laws.

### 3.1 Particle Dynamics (V7.0 Physics Kernel)
*   **Base Particles**: 8 Chart Characters (Year/Month/Day/Hour Stems & Branches).
*   **Positional Weighting (V7.0)**:
    *   **Month Branch (Solar Ecliptic)**: Source of Thermodynamics ($W \approx 4.5$).
    *   **Hour Branch (Solar Angle)**: Diurnal Adjustment ($W \approx 2.5$).
    *   **Day/Year Branch**: Near-Field/Background ($W \approx 1.5$).

### 3.2 Wave-Source Protocol (V7.1)
Distinguishes between **Potential Energy (Branch/Storage)** and **Kinetic Intensity (Stem/Emitter)**.
*   **Rooting Algorithm**:
    *   Formula: $I_{stem} = I_{base} + \sum (M_{branch} \times T \times D)$
    *   $T$ (Transmittance): Based on element distribution (本气/中气/余气).
    *   $D$ (Distance Decay): Decay matrix $[1.0, 0.7, 0.4, 0.2]$ for pillar distance.
*   **Phase Locking (Three Harmony)**: Tri-Harmony combinations (e.g., Shen-Zi-Chen) cause particles to "phase lock," massively boosting amplitude and collapsing vectors towards the target element (Water).

### 3.2 Entropy & Perturbation
*   **Shell Rupture (Clash)**: Clashes (e.g., Zi-Wu) cause particle decoherence, increasing system Entropy (Sigma) and dampening Amplitude (Mu).
*   **Double Binding (Hui Qi)**: Specific combinations (e.g., Tian He Di He) between Day Pillar and Liu Nian cause system stagnation (low energy, high entropy).

## 4. Quantum Engine (The Probabilistic Layer)
The `QuantumEngine` translates Flux Energy into Life Aspect Probability Distributions.

### 4.1 Ten Gods Mapping (Dynamic Overlay)
1.  **Static Calculation**: Calculate Ten Gods scores based on the static Birth Chart.
2.  **Dynamic Injection**: Overlay the dynamic energy scores from `FluxEngine` (which include Da Yun/Liu Nian effects). This ensures the simulation reflects the *current* time-space vector.

### 4.2 Wavefunction Superposition
Life Aspects are not single stars but weighted superpositions of multiple Ten Gods.

*   **Example: Wealth Wavefunction**
    ```
    |Ψ_Wealth⟩ = 0.9|PianCai⟩ + 0.8|ZhengCai⟩ + 0.5|ShangGuan⟩ + ...
    ```

### 4.3 Probability Collapse (Simulation)
The system calculates the final Probability Density Function (PDF) for each aspect using a Gaussian approximations:

*   **Expected Value (Mu)**: The weighted sum of Ten Gods energies (constructive interference).
*   **Uncertainty (Sigma)**: Derived from the volatility of specific stars (e.g., QiSha is volatile) PLUS the Global Entropy from the Flux Engine (clashes/conflicts).

*   **Result**: A Bell Curve where:
    *   **Peak**: Most likely outcome.
    *   **Width**: Risk/Opportunity interval.

## 5. UI Visualization
The Dashboard visualizes this via:
1.  **Pillar Standing Waves**: Bar charts showing the raw amplitude of each character, including Deltas (changes) caused by time injection.
2.  **Quantum Ten Gods Spectrum**: A 5-column breakdown of the 10 dimensions, showing the shift from Native State to Dynamic State.
3.  **Wavefunction Expander**:
    *   **Bell Curve**: The visual PDF.
    *   **Composition Analysis**: A detailed breakdown of the "Ingredients" (Ten Gods Weights + Entropy) proving the algorithmic derivation.
    *   **Reaction Log**: A trace of physical interactions (Clashes/Combinations) that perturbed the wave parameters.

## 6. Future Roadmap
*   **TensorFlow Integration**: Move matrix calculations to TF/PyTorch for GPU acceleration.
*   **True Interference**: Implement complex number wavefunctions to simulate true quantum interference (phase cancellation) rather than just scalar addition.
