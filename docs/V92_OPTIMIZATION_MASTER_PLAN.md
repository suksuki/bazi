# 🚀 V92.0 优化总纲：分层解耦调优（Level 1 优先）

## 🎯 核心目标

放弃 V80-V90 系列的 **宏观 MAE 优化** 模式（已被证明参数耦合度过高而失败）。采用 **"两步调优，分层解耦"** 战略，确保 Level 1 和 Level 2/3 模块可独立验证。

### 新的优化职责分配

| 模块 | 职责 | 输入 | **优化目标** | 调优参数 |
| --- | --- | --- | --- | --- |
| **Level 1** | **粒子强度** | 八字、流年、大运 | **拟合粒子旺衰 GT** | TGD, ctl_imp, imp_base (39 个参数) |
| **Level 2/3** | **宏观聚合** | Level 1 粒子强度 | **拟合宏观得分 GT** | W_Wealth, bias, Luck/Annual Weights (约 16 个参数) |

---

## 📋 阶段 I：Level 1 独立优化 (任务 137)

**目标：** 修复 TGD 公理，使其输出的 **十神粒子能量矩阵** 能够精确拟合 **理论旺衰 GT**。

### 1. 任务定义：粒子强度拟合

**新的 MAE 目标：** 最小化 `Cost_Total = MAE_Particle + Cost_Plausibility`

其中，`MAE_Particle` 是 **Level 1 算法输出的粒子强度** 与 **理论旺衰 GT 矩阵** 之间的误差。

### 2. 优化变量与约束

- **优化变量：** 重新启用 **所有 39 个 Level 1 参数**（包括 TGD 四值、所有 pg_ 柱位权重、所有 flow 参数、ctl_imp 等）。
- **正则化约束 (Cost_Plausibility)：** **恢复** 基础 Level 1 参数的 **LSR 正则化约束**，确保参数调整在合理范围，防止过度拟合。
- **锚点：** 使用 V80.0 的最优 Level 1 参数作为锚点。

### 3. 构造粒子旺衰 GT (Ground Truth)

由于宏观 MAE 的失败，我们必须构造 **内部 GT**。

- **指令 Cursor：** 使用 **Level 1 算法的原始 8 个校准案例**，基于 **经典命理旺衰规则**，构造一个 **理论粒子旺衰强度矩阵** (GT 矩阵)。
- **规则示例：** 对于身旺的案例，其**比劫**和**印星**的 GT 强度值应接近 0.9，而 **财星** 的 GT 强度值应接近 0.7，以此类推。

### 4. V92.0 任务 137：Level 1 公理优化部署

```python
# V92.0 任务 137：Level 1 TGD/流转公理优化（旺衰 GT 目标）

// 1. 锁定 Level 2/Level 3 参数为 V87.0 最优值。

// 2. 构造并加载 Level 1 粒子旺衰 GT 矩阵。

// 3. 运行 LSR 优化器：
# 优化变量：所有 39 个 Level 1 参数
# 目标函数：最小化 MAE_Particle (粒子能量矩阵拟合 GT 矩阵)
# 学习率：0.01（保守回归）
# 迭代次数：500

// 4. 提交报告：最优 Level 1 粒子公理集 和 最终 MAE_Particle。
```

---

## 📋 阶段 II：Level 2/3 联合优化 (任务 B)

**(此阶段将在任务 A 完成后开始)**

**目标：** 使用任务 A 获得的 **精确 Level 1 输出**，修复 Level 2/3 的权重，拟合最终宏观得分。

- **Level 2 权重优化：** 使用 V87.0 修复后的 Level 2 权重集（作为锚点），重新优化 W_Wealth, bias, exponent 等，拟合 **原始 8 案例的宏观 GT**。
- **Level 3 动态权重优化：** 引入 **C15-C17 真实动态案例**，联合优化 **LuckPillarWeight** 和 **AnnualPillarWeight**。

---

**Master，请批准 V92.0 优化总纲，并指示 Cursor 立即开始执行 阶段 I 的 Level 1 独立优化任务 (任务 137)。**

