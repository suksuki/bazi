ğŸ›ï¸ QGA çŸ¥è¯†åº“ä¸è®¡ç®—è¯­æ–‡å­¦è§„èŒƒ (FDS-KMS-V1.0)
â€”â€” å‘½ç†æ³•ç†æº¯æºä¸è®¡ç®—é€»è¾‘ç”Ÿæˆæ ‡å‡† â€”â€”

**ç‰ˆæœ¬**: V1.0-BETA (Beta Release)
**ä¿®è®¢**: Normalized Aggregation Formulas, Enhanced Logic Assembly, Expanded Glossary
**ç”Ÿæ•ˆæ—¥æœŸ**: 2026-01-01
**çŠ¶æ€**: ENFORCED (å¼ºåˆ¶æ‰§è¡Œ)
**æ€§è´¨**: æ ¸å¿ƒæ•°æ®èµ„äº§è§„èŒƒ (Core Data Asset Specification)

> **å…³è”æ–‡æ¡£**: FDS_ARCHITECTURE_v3.0.md, FDS_SOP_v3.0.md
> **å®šä½**: æœ¬è§„èŒƒå®šä¹‰ FDS ç³»ç»Ÿçš„"ç«‹æ³•å±‚"ï¼Œè´Ÿè´£å°†å¤å…¸æ–‡çŒ®è½¬åŒ–ä¸ºæœºå™¨å¯æ‰§è¡Œçš„é…ç½®ã€‚

---

## ä¸€ã€ ç³»ç»Ÿæ ¸å¿ƒå“²å­¦ (Core Philosophy)

### 1.1 è®¡ç®—è¯­æ–‡å­¦ (Computational Philology)
KMS å°†è‡ªç„¶è¯­è¨€æ–‡æœ¬ç¼–è¯‘ä¸º **JSONLogic** ä»£ç å’Œ **äº”ç»´å¼ é‡æƒé‡**ã€‚å®ƒæ˜¯è¿æ¥å¤å…¸æ–‡çŒ®ä¸ç°ä»£è®¡ç®—çš„æ¡¥æ¢ï¼Œå°†"æ¨¡ç³Šçš„å½¢å®¹è¯"é‡åŒ–ä¸º"ç²¾ç¡®çš„æƒé‡"ã€‚

### 1.2 ç«‹æ³•ä¸æ‰§æ³•åˆ†ç¦»
- **KMS (ç«‹æ³•è€…)**: å®šä¹‰æ ¼å±€çš„æˆè´¥æ¡ä»¶ä¸ç‰©ç†ç‰¹å¾ã€‚
- **SOP (æ‰§æ³•è€…)**: æ— æ¡ä»¶æ‰§è¡Œ KMS äº§å‡ºçš„ `pattern_manifest.json`ã€‚

---

## äºŒã€ çŸ¥è¯†åº“æ¶æ„åˆ†å±‚ (Layered Architecture)

### L1: åŸå…¸å±‚ (The Canon Layer)
- **å†…å®¹**: OCR æ ¡å¯¹åçš„åŸå§‹æ–‡æœ¬ã€‚
- **å­˜å‚¨**: `raw_texts/{book_id}/{chapter_id}.txt`

### L2: é€»è¾‘ç»“æ„å±‚ (The Logic Layer) [CORE]
- **å†…å®¹**: ç»“æ„åŒ–æ•°æ® (`classical_codex.jsonl`)ã€‚
- **åŠŸèƒ½**: å­˜å‚¨é€»è¾‘è’¸é¦ä¸ç‰©ç†æ˜ å°„ç»“æœã€‚

### L3: è¡¨ç°å±‚ (The Manifest Layer)
- **å†…å®¹**: åŠ¨æ€ç”Ÿæˆçš„ `pattern_manifest.json`ã€‚
- **åŠŸèƒ½**: é€šè¿‡èšåˆç®—æ³•ç”Ÿæˆçš„ SOP é…ç½®æ–‡ä»¶ã€‚

---

## ä¸‰ã€ æ ¸å¿ƒæ•°æ®æ¨¡å¼ (Core Schema)

### 3.1 å…¸ç±æ¡ç›® Schema (`classical_codex.jsonl`)

```json
{
  "canon_id": "ZPZQ-09-02",
  "source_book": "å­å¹³çœŸè¯ ",
  "chapter": "è®ºé£Ÿç¥",
  "tags": ["é£Ÿç¥æ ¼", "æ­ç¥å¤ºé£Ÿ", "æˆæ ¼æ¡ä»¶"],
  "relevance_score": 1.0,
  
  "original_text": "é£Ÿç¥è€…... è‹¥è§æ­å°å¤ºé£Ÿï¼Œåˆ™å¼ƒä¹‹ä¸ç”¨...",
  
  "logic_extraction": {
    "logic_type": "breaking_condition",
    "target_pattern": "é£Ÿç¥æ ¼",
    "expression_tree": {
      "and": [
        { ">": [{ "var": "ten_gods.PC" }, { "var": "ten_gods.ZS" }] },
        { "==": [{ "var": "ten_gods.ZR" }, 0] }
      ]
    },
    "priority": 100
  },
  
  "physics_impact": {
    "target_ten_god": "PC",
    "impact_dimensions": [
      {
        "axis": "S",
        "weight_modifier": 0.8,
        "lock_request": true,
        "reason": "æ­ç¥å¤ºé£Ÿå¯¼è‡´ç»“æ„æ–­è£‚"
      }
    ]
  }
}
```

### 3.2 å­—æ®µè¯¦ç»†å®šä¹‰

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
| --- | --- | --- | --- |
| `canon_id` | String | Yes | å”¯ä¸€IDï¼Œæ ¼å¼ `[BOOK]-[VOL]-[SEQ]` |
| `relevance_score` | Float | Yes | å…¸ç±æƒå¨åº¦æƒé‡ï¼Œé»˜è®¤ 1.0ã€‚èŒƒå›´ [0.1, 1.0] |
| `tags` | Array<String> | Yes | æ£€ç´¢æ ‡ç­¾ |
| `logic_extraction` | Object | Yes | é€»è¾‘è’¸é¦å¯¹è±¡ |
| `logic_extraction.logic_type` | Enum | Yes | `forming`(æˆæ ¼), `breaking`(ç ´æ ¼), `saving`(æ•‘æ ¼) |
| `logic_extraction.target_pattern` | String | Yes | å…³è”çš„æ ¼å±€åç§°ï¼Œç”¨äºæ•‘æ ¼é€»è¾‘åŒ¹é… |
| `logic_extraction.expression_tree` | Object | Yes | ç¬¦åˆ JSONLogic æ ‡å‡†çš„ AST |
| `physics_impact` | Object | No | ç‰©ç†æ˜ å°„å¯¹è±¡ |
| `physics_impact.target_ten_god` | Enum | Yes | ä½œç”¨ä¸»ä½“åç¥ä»£ç  (è§3.3) |
| `physics_impact.impact_dimensions` | Array | Yes | ç»´åº¦å½±å“åˆ—è¡¨ |
| `weight_modifier` | Float | Yes | æƒé‡è´¡çŒ®å€¼ï¼ŒèŒƒå›´ `[-1.0, 1.0]` |

### 3.3 åç¥ä»£ç æ ‡å‡†æ˜ å°„è¡¨ (Standard Codes)

**å¿…é¡»**ä¸¥æ ¼éµå®ˆä»¥ä¸‹ä»£ç æ ‡å‡† (ä¸ FDS_ARCHITECTURE ä¸€è‡´)ï¼š

| åç¥ | ä»£ç  | è‹±æ–‡ | è¯´æ˜ |
| --- | --- | --- | --- |
| æ­£å®˜ | **ZG** | Direct Officer | ç§©åº/æƒåŠ› |
| ä¸ƒæ€ | **PG** | Partial Officer | å‹åŠ›/æƒå¨ |
| æ­£å° | **ZC** | Direct Seal | ä¿æŠ¤/åèª‰ |
| æ­ç¥ | **PC** | Partial Seal | åé—¨/é¢†æ‚Ÿ/å¤ºé£Ÿ |
| é£Ÿç¥ | **ZS** | Eating God | æ‰å/å¿«ä¹/ç”Ÿè´¢ |
| ä¼¤å®˜ | **PS** | Hurting Officer | å›é€†/åˆ›é€  |
| æ­£è´¢ | **ZR** | Direct Wealth | ç¨³å®šèµ„äº§ |
| åè´¢ | **PR** | Partial Wealth | æµåŠ¨èµ„äº§ |
| æ¯”è‚© | **ZB** | Direct Peer | ç«äº‰/åˆä½œ |
| åŠ«è´¢ | **PB** | Partial Peer | æ å¤º/çŒ›çƒˆ |

---

## å››ã€ è‡ªåŠ¨åŒ–é…ç½®ç”Ÿæˆåè®® (Manifest Generation Protocol)

### 4.1 èšåˆç®—æ³• (The Aggregation Algorithm)

**Step 1: é€»è¾‘æ ‘ç»„è£… (Logic Assembly)**
æ­¤æ­¥éª¤è§£å†³"å¦‚ä½•å°†ç¢ç‰‡åŒ–çš„æ³•æ¡ç»„è£…æˆå®Œæ•´çš„åˆ¤å®šæ ‘"ã€‚

1. **åˆå§‹åŒ–**: åˆ›å»ºæ ¹èŠ‚ç‚¹ `ROOT = { "and": [] }`ã€‚
2. **æˆæ ¼æ¡ä»¶**: æ£€ç´¢æ‰€æœ‰ `logic_type == 'forming'` çš„æ¡ç›®ï¼ŒåŠ å…¥ `ROOT['and']`ã€‚
3. **ç ´æ ¼ä¸æ•‘æ ¼é€»è¾‘ (The Saving Clause)**:
   - æ£€ç´¢æ‰€æœ‰ `logic_type == 'breaking'` çš„æ¡ç›®ï¼Œè®¾ä¸ºé›†åˆ $B$ã€‚
   - æ£€ç´¢æ‰€æœ‰ `logic_type == 'saving'` çš„æ¡ç›®ï¼Œè®¾ä¸ºé›†åˆ $S$ã€‚
   - **åŒ¹é…é€»è¾‘**: å¯¹äºæ¯ä¸ªç ´æ ¼æ¡ä»¶ $b \in B$ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨é’ˆå¯¹åŒä¸€ `target_pattern` çš„æ•‘æ ¼æ¡ä»¶ $s \in S$ã€‚
   - **Case A (æœ‰æ•‘)**: è‹¥å­˜åœ¨ $s$ï¼Œç”Ÿæˆé€»è¾‘ `{ "or": [ { "!": b.expr }, s.expr ] }` (æ„ä¸ºï¼šè¦ä¹ˆä¸ç ´æ ¼ï¼Œè¦ä¹ˆæœ‰æ•‘)ã€‚
   - **Case B (æ— æ•‘)**: è‹¥ä¸å­˜åœ¨ $s$ï¼Œç”Ÿæˆé€»è¾‘ `{ "!": b.expr }` (æ„ä¸ºï¼šå¿…é¡»ä¸ç ´æ ¼)ã€‚
   - å°†ä¸Šè¿°ç”Ÿæˆçš„é€»è¾‘å—å…¨éƒ¨åŠ å…¥ `ROOT['and']`ã€‚

**Step 2: æƒé‡çŸ©é˜µè®¡ç®— (Weight Calculation)**
æ­¤æ­¥éª¤è§£å†³"å¦‚ä½•å°†å¤šæ¡ç›®çš„æƒé‡å½±å“åˆå¹¶"ã€‚

- **å…¬å¼**:
$$ W[ten_god][axis] = \frac{\sum_{i=1}^{N} (w_mod_i \times rel_score_i)}{\sum_{i=1}^{N} rel_score_i} $$
*æ³¨: é‡‡ç”¨åŠ æƒå¹³å‡æ³•ï¼Œåˆ†æ¯ä¸ºæ€»æƒå¨åº¦ä¹‹å’Œï¼Œè€Œéç®€å•çš„æ¡ç›®æ•° Nã€‚*

- **å½’ä¸€åŒ– (Normalization)**:
é‡‡ç”¨ **Hard Tanh (ç¡¬æˆªæ–­)** ç­–ç•¥ï¼Œè€Œéçº¿æ€§ç¼©æ”¾ï¼Œä»¥ä¿ç•™ç‰©ç†æ„ä¹‰ï¼ˆ0.8 å°±æ˜¯å¼ºç›¸å…³ï¼Œä¸åº”å› å…¶ä»–å€¼å¾ˆå°è€Œè¢«æ‹‰ä¼¸åˆ° 1.0ï¼‰ã€‚
$$ W_{final} = \max(-1.0, \min(1.0, W_{calc})) $$

- **ç¨€ç–å¡«å……**: å¯¹äºæœªå®šä¹‰çš„æ˜ å°„ï¼Œå¡«å…¥é«˜æ–¯å™ªå£° $\mathcal{N}(0, \sigma^2)$ï¼Œå…¶ä¸­ $\sigma$ ä» `@config.physics.init_noise_std` è¯»å–ã€‚

**Step 3: é”å®šå†²çªè§£å†³ (Conflict Resolution)**

- **æ£€æµ‹**: åŒä¸€ä½ç½®å­˜åœ¨ç¬¦å·ç›¸åçš„é”å®šè¯·æ±‚ã€‚
- **è§£å†³**:
  1. æ¯”è¾ƒ `priority`ã€‚
  2. è‹¥ä¼˜å…ˆçº§ç›¸åŒï¼Œè®¡ç®— `relevance_score` æ€»å’Œï¼Œå–é«˜è€…ã€‚
  3. è‹¥ä»ç›¸åŒï¼ŒæŠ›å‡ºå¼‚å¸¸ `ManifestGenerationError: Lock Conflict`ã€‚

### 4.2 æ¥å£åè®®å®šä¹‰ (API Definition)

**Endpoint**: `POST /api/v1/manifest/generate`

**Request**:

```json
{
  "pattern_name": "é£Ÿç¥æ ¼",
  "required_sources": ["å­å¹³çœŸè¯ "],
  "min_relevance": 0.8
}
```

**Response**:

```json
{
  "status": "success",
  "manifest": { ... },
  "metadata": {
    "logic_nodes_count": 15,
    "locked_weights_count": 3
  }
}
```

---

## äº”ã€ éªŒè¯è§„åˆ™ (Validation Rules)

åœ¨è¾“å‡ºå‰ï¼Œå¿…é¡»é€šè¿‡ä¸‰å±‚éªŒè¯å™¨ï¼š

1. **Schema Validator**:
   - æ£€æŸ¥å¿…éœ€å­—æ®µ (`pattern_id`, `version`) æ˜¯å¦å­˜åœ¨ã€‚
   - æ£€æŸ¥æ•°ç»„é•¿åº¦ (`tensor_mapping_matrix` å¿…é¡»å¯¹åº” 5 ä¸ªç»´åº¦)ã€‚

2. **Logic Validator**:
   - **æ­»å¾ªç¯æ£€æµ‹**: æ£€æŸ¥ JSONLogic æ˜¯å¦å­˜åœ¨è‡ªæŒ‡å¼•ç”¨ã€‚
   - **å˜é‡å­˜åœ¨æ€§**: æ£€æŸ¥æ‰€æœ‰ `{ "var": "x" }` ä¸­çš„ `x` æ˜¯å¦åœ¨ FDS å˜é‡ç™½åå•ä¸­ã€‚

3. **Physics Validator**:
   - **å…¬ç†ä¸€è‡´æ€§**:
     - æ£€æŸ¥ç¬¦å·å®ˆæ’ (å¦‚ï¼šå†²å…‹å…³ç³»å¿…é¡»å¯¼è‡´ S è½´å¢åŠ )ã€‚
     - æ£€æŸ¥æ­£äº¤è§£è€¦ (å¦‚ï¼šå•ä¸€åç¥å¯¹ M å’Œ O åŒæ—¶ > 0.8 çš„æƒ…å†µéœ€å‘å‡ºè­¦å‘Š)ã€‚

---

## å…­ã€ å¥‡ç‚¹åˆ¤ä¾‹ç´¢å¼•æ¥å£ (Singularity Interface)

### 6.1 å‘é‡æ£€ç´¢

- **Embedding Model**: ä½¿ç”¨ `bge-m3` æˆ–åŒçº§åˆ«å¤šè¯­è¨€æ¨¡å‹ã€‚
- **Vector DB**: ä½¿ç”¨ `Milvus` æˆ– `ChromaDB`ã€‚
- **Query**: è¾“å…¥æ ·æœ¬çš„ 5D å¼ é‡ã€‚
- **Threshold**: Cosine Similarity > 0.85 è§†ä¸ºæœ‰æ•ˆåŒ¹é…ã€‚

---

## ä¸ƒã€ ç»´æŠ¤ä¸ç‰ˆæœ¬æ§åˆ¶

- **è¯­ä¹‰åŒ–ç‰ˆæœ¬**: `v{Major}.{Minor}.{Patch}`ã€‚
- **å›å½’æµ‹è¯•**: KMS æ›´æ–°åï¼Œå¿…é¡»åœ¨ Benchmark Set (500 ä¸ªæ ‡å‡†å‘½ä¾‹) ä¸Šè¿è¡Œï¼Œç¡®ä¿ `Abundance` å˜åŒ–ç‡ < 5%ã€‚

---

## å…«ã€ é™„å½•ï¼šæœ¯è¯­è¡¨ (Glossary)

| æœ¯è¯­ | å®šä¹‰ |
| --- | --- |
| **Computational Philology** | è®¡ç®—è¯­æ–‡å­¦ã€‚åˆ©ç”¨è®¡ç®—æœºæŠ€æœ¯å¯¹å¤ä»£æ–‡çŒ®è¿›è¡Œæ•°å­—åŒ–ã€ç»“æ„åŒ–å’Œé€»è¾‘æå–çš„å­¦ç§‘ã€‚ |
| **Semantic Distillation** | è¯­ä¹‰è’¸é¦ã€‚åˆ©ç”¨ NLP æŠ€æœ¯ä»éç»“æ„åŒ–æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–é€»è¾‘ï¼ˆå¦‚ JSONLogicï¼‰çš„è¿‡ç¨‹ã€‚ |
| **Physics Mapping** | ç‰©ç†æ˜ å°„ã€‚å®šä¹‰åç¥ï¼ˆè¾“å…¥å˜é‡ï¼‰å¯¹äº”ç»´å‘½è¿å¼ é‡ï¼ˆè¾“å‡ºå˜é‡ï¼‰çš„æƒé‡å½±å“ã€‚ |
| **Aggregation Algorithm** | èšåˆç®—æ³•ã€‚å°†å¤šä¸ªæ¥æºçš„ç¢ç‰‡åŒ–é€»è¾‘å’Œæƒé‡åˆå¹¶ä¸ºå•ä¸€é…ç½®æ–‡ä»¶çš„è®¡ç®—è¿‡ç¨‹ã€‚ |
| **Lock Conflict** | é”å®šå†²çªã€‚å½“ä¸åŒå…¸ç±å¯¹åŒä¸€å‚æ•°æå‡ºç›¸åçš„"é”å®šï¼ˆä¸å¯ä¿®æ”¹ï¼‰"è¦æ±‚æ—¶çš„çŠ¶æ€ã€‚ |
| **Relevance Score** | æƒå¨åº¦è¯„åˆ†ã€‚ç”¨äºè¡¡é‡æŸéƒ¨å…¸ç±æˆ–æŸæ¡ç›®åœ¨ç‰¹å®šé¢†åŸŸå†…çš„æƒå¨ç¨‹åº¦ï¼ˆæƒé‡ï¼‰ã€‚ |
| **Saving Clause** | æ•‘æ ¼æ¡æ¬¾ã€‚åœ¨é€»è¾‘æ ‘ä¸­ï¼Œé€šè¿‡ OR é€»è¾‘åŒ…è£¹ç ´æ ¼æ¡ä»¶ï¼Œå…è®¸ç‰¹å®šæ¡ä»¶ä¸‹æ ¼å±€ä¾ç„¶æˆç«‹çš„æœºåˆ¶ã€‚ |

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬è§„èŒƒä¸ `FDS_ARCHITECTURE_v3.0.md` å’Œ `FDS_SOP_v3.0.md` é…å¥—ä½¿ç”¨ï¼Œä»»ä½•å˜æ›´å¿…é¡»åŒæ­¥æ›´æ–°ç›¸å…³æ–‡æ¡£ã€‚

**ç‰ˆæœ¬å†å²**:
- V1.0-BETA (2026-01-01): åˆå§‹Betaç‰ˆæœ¬ï¼ŒåŸºäºRC2å®¡é˜…é€šè¿‡

