# 视频学习并发与字幕优化改进

## 📋 改进内容

本次更新包含三个主要改进：

### 1. ⚡ 提高默认并发数（从 1 → 3）

**修改文件**: `core/config_manager.py`

- 新增 `DEFAULT_CONFIG` 字典，统一管理默认配置
- 将 `max_concurrent_jobs` 默认值从 1 提高到 3
- 提升多视频学习任务的并行处理能力

**效果**: 
- 同时处理 3 个学习任务，大幅提升学习效率
- 合理利用系统资源，避免过度占用

---

### 2. 🎛️ 添加并发数设置界面

**修改文件**: `ui/pages/system_config.py`

新增了完整的学习任务配置区域：

#### 📚 学习任务引擎配置
- **最大并发任务数**: 可设置 1-10 个并发任务
  - 提供了详细的帮助说明
  - 修改后立即生效，不需重启
  
- **字幕优先级开关**: 
  - 开启后优先使用 CC 字幕
  - 跳过 Whisper 转录，大幅提升速度
  
- **字幕语言优先级配置**:
  - 可自定义字幕语言下载顺序
  - 默认优先级: zh-Hans → zh-Hant → zh-CN → zh-TW → zh → en
  - 支持按行编辑，灵活配置

**界面位置**: 系统控制台 → 学习任务引擎

---

### 3. 💬 优化字幕下载逻辑

**修改文件**: 
- `learning/video_downloader.py`
- `core/scheduler.py`

#### 核心改进：
1. **配置驱动**: 从 ConfigManager 读取字幕语言优先级
2. **动态控制**: 支持开关字幕优先级功能
3. **智能日志**: 显示下载的字幕语言信息

#### 工作流程：
```
1. 检查配置：是否启用字幕优先级？
   ├─ 是: 尝试按优先级下载字幕
   │   ├─ 成功: 直接使用字幕 ✅
   │   └─ 失败: 下载音频 → Whisper 转录
   └─ 否: 直接下载音频 → Whisper 转录
```

---

## 🎯 使用方法

### 调整并发数
1. 进入 **系统控制台** 页面
2. 在 **学习任务引擎** 区域
3. 调整 **最大并发任务数** (建议 3-5)
4. 修改立即生效

### 配置字幕优先级
1. 在 **学习任务引擎** 区域勾选 **优先使用CC字幕**
2. 展开 **字幕语言优先级** 可自定义语言顺序
3. 每行一个语言代码（如 zh-Hans, en）

### 查看实时状态
1. 进入 **任务控制中心**
2. 顶部显示当前配置：
   - ⚡ 最大并发数
   - 💬 字幕优先级状态
3. 点击 **修改配置** 快速跳转设置页面

---

## 📊 性能提升

| 场景 | 改进前 | 改进后 | 提升 |
|------|--------|--------|------|
| 并发处理 | 1 个任务 | 3 个任务 | 3x |
| 有字幕视频 | 下载音频 + Whisper | 直接下载字幕 | 10x+ |
| 配置灵活性 | 硬编码 | 可视化配置 | ∞ |

---

## ✅ 测试建议

1. **测试并发**: 添加 3-5 个视频到队列，观察并发执行
2. **测试字幕**: 选择有中文字幕的视频，验证字幕优先下载
3. **测试配置**: 在系统控制台调整配置，观察立即生效

---

## 🔧 技术细节

### 配置优先级层级
```python
配置文件 > DEFAULT_CONFIG > 函数默认参数
```

### 字幕语言代码
常用代码：
- `zh-Hans`: 简体中文
- `zh-Hant`: 繁体中文  
- `zh-CN`: 中国大陆中文
- `zh-TW`: 台湾中文
- `zh`: 通用中文
- `en`: 英文

---

## 📝 更新日期
2025-12-08
