# QGA 八字格局验证规范 (QGA-VV V1.0)

**版本**: V1.0  
**生效日期**: 2026-01-02  
**状态**: ENFORCED (强制执行)  
**依赖**: FDS-V3.0, QGA-HR V3.0, FDS-LKV V1.0

---

## 一、总则

本规范定义 FDS 系统如何验证八字与格局的吻合度，以及如何输出标准化的预测解释。

### 1.1 核心原则

| 原则 | 说明 |
|------|------|
| **计算归本地** | 马氏距离、精密评分由 registry_loader 计算 |
| **审计归知识库** | 公理校验、异常修正由 compliance_router 执行 |
| **解释三段式** | 输出必须包含物理+古典+案例三维度 |

---

## 二、多维判别逻辑 (Multi-layer Verification)

### 2.1 三层检索协议

当输入"八字+大运+流年"时，系统执行：

**Layer 1: 宏观重心检索**
```
输入: 5D 张量 T_input
操作: 与全量主格局流形 (MANIFOLD_*) 计算马氏距离
输出: Top 3 候选格局 + 精密评分
```

**Layer 2: 子格局/奇点溯源**
```
触发条件: D_M > 2.5 或 precision_score < 0.7
操作: 在 singularity_vault 检索最近邻
输出: 匹配奇点 + 子格局类型
```

**Layer 3: 时空动态修正**
```
输入: 大运干支 + 流年干支
操作: 计算 ΔT (张量位移)
判定: 格变 / 格破 / 格成
```

### 2.2 判定优先级

1. D_M < 1.5 且 cos_sim > 0.85 → **STANDARD_MATCH**
2. 奇点匹配距离 < 0.1 → **SINGULARITY_MATCH**
3. 语义公理符合 + precision > 0.5 → **MARGINAL_MATCH**
4. 其他 → **NO_MATCH**

---

## 三、格局解释协议 (Explanation Protocol)

### 3.1 三段式输出格式 [强制]

所有预测输出必须包含以下三个维度：

**第一段：物理态描述**
```
描述五维张量分布状态
格式: "E轴[状态], O轴[状态], M轴[状态], S轴[状态], R轴[状态]"
示例: "E轴能级充沛(0.72), S轴应力可控(0.45), M轴财位偏弱(0.15)"
```

**第二段：古典模型对照**
```
引用语义库中的公理分片
格式: "符合[格局]的[条件]定义，[引用古籍]"
示例: "符合羊刃格的'刃杀两停'定义，印星化杀有力"
```

**第三段：奇点案例参考**
```
引用 singularity_vault 中的案例
格式: "此张量组合在[样本库]中表现为[轨迹概述]"
示例: "此特征在 518k 样本中多表现为武职、开创型事业"
```

### 3.2 禁止行为

- ❌ 禁止输出无依据的模糊描述
- ❌ 禁止只输出分数不输出解释
- ❌ 禁止使用"可能"、"大概"等不确定性词汇（除边缘态）

---

## 四、门控与异常处理

### 4.1 逻辑漂移检测

当物理分数与公理逻辑冲突时：

```
条件: |precision_score - axiom_alignment| > 0.3
动作: 标记为 "LOGIC_DRIFT" (逻辑漂移)
输出: 在报告中标注冲突原因
```

### 4.2 安全门控

| 门控类型 | 触发条件 | 动作 |
|----------|----------|------|
| E-Gating | E < weak_self_limit | 强制降格 |
| S-Gating | S > stress_limit | 标记风险 |
| R-Gating | R > relation_limit | 警告过耦合 |

---

## 五、输出模板

### 5.1 标准匹配报告

```
【吻合度审计报告】
格局: [pattern_id]
判定: ✅ 标准匹配

【物理态】
[五轴描述]

【古典对照】
[公理引用]

【案例参考】
[奇点/丰度引用]

置信度: [score]
```

### 5.2 奇点匹配报告

```
【吻合度审计报告】
格局: [pattern_id]
判定: 🔮 奇点匹配

【物理态】
[五轴描述]
马氏距离偏离标准流形

【奇点溯源】
最近邻: [case_id]
子格局: [sub_pattern]
相似度: [distance]

【轨迹参考】
[y_true 摘要]

置信度: [score]
```
