# QGA V25.0 Phase 3 é€»è¾‘å…¬ç†æ‰‹å†Œæ€»ç»“

## å®Œæˆæ—¶é—´
2024å¹´ï¼ˆå½“å‰ä¼šè¯ï¼‰

## å®Œæˆçš„å·¥ä½œ

### âœ… Task 3.1: é€»è¾‘å…¬ç†åŒ–å®šä¹‰

**æ–‡ä»¶**: `core/subjects/neural_router/registry.json`

**ä¸º7ä¸ªæ ¼å±€æ·»åŠ äº†ç‰©ç†å…¬ç†ï¼ˆphysical_axiomï¼‰**:

1. **SHANG_GUAN_JIAN_GUAN (ä¼¤å®˜è§å®˜)**
   - è§¦å‘æ¡ä»¶: "å½“åº”åŠ›å¼ é‡ > 0.6 ä¸”é‡‘ç«åœºå¼ºå½¢æˆ 180Â° ç›¸ä½å¯¹å†²æ—¶ï¼Œè§¦å‘æ™¶æ ¼ç“¦è§£é€»è¾‘"
   - èƒ½é‡æ–¹ç¨‹: `E_collapse = (stress_tensor - 0.6) Ã— (|metal_field - fire_field|) Ã— 100`
   - ç›¸ä½å…³ç³»: "é‡‘ï¼ˆå®˜æ˜Ÿï¼‰ä¸ç«ï¼ˆä¼¤å®˜ï¼‰å½¢æˆ180Â°ç›¸ä½å¯¹å†²ï¼Œäº§ç”Ÿç»“æ„è„†æ€§æ–­è£‚"
   - ä¿®æ­£æœºåˆ¶: "é€šè¿‡åœŸï¼ˆè´¢æ˜Ÿï¼‰ä½œä¸ºç¼“å†²ä»‹è´¨ï¼Œå®ç°ç«â†’åœŸâ†’é‡‘çš„èƒ½é‡ä¼ å¯¼é“¾"
   - åç¼©é˜ˆå€¼: 0.6
   - æ¢å¤è·¯å¾„: "è´¢æ˜Ÿé€šå…³ï¼šearth_field > 0.3 æ—¶ï¼Œç³»ç»Ÿå¯é€šè¿‡åˆ©ç›Šç½®æ¢åŒ–è§£å†²çª"

2. **XIAO_SHEN_DUO_SHI (æ­ç¥å¤ºé£Ÿ)**
   - è§¦å‘æ¡ä»¶: "å½“åŠ¨é‡é¡¹è¡¨ç°ä¸º'å°â†’æ—¥'å•å‘æ·¤ç§¯ä¸”'æ—¥â†’é£Ÿ'åŠ¨é‡ä¸º 0 æ—¶ï¼Œè§¦å‘ç”Ÿç‰©èƒ½æˆªæ–­"
   - èƒ½é‡æ–¹ç¨‹: `E_interrupt = (yin_momentum Ã— water_field) - (fire_field Ã— shi_momentum)`
   - ç›¸ä½å…³ç³»: "åå°ï¼ˆæ°´/æœ¨ï¼‰ä½œä¸ºæ‹¦æˆªå™¨ï¼Œé˜»æ–­é£Ÿç¥ï¼ˆç«/åœŸï¼‰çš„èƒ½é‡ä¾›ç»™é€šé“"
   - ä¿®æ­£æœºåˆ¶: "é€šè¿‡è´¢æ˜Ÿï¼ˆåœŸ/é‡‘ï¼‰ä½œä¸ºé€šå…³ä»‹è´¨ï¼Œå¼ºè¡Œæ‰“é€šè¢«æˆªæ–­çš„å›è·¯"
   - åç¼©é˜ˆå€¼: 0.5
   - æ¢å¤è·¯å¾„: "è´¢æ˜Ÿé€šå…³ï¼šearth_field + metal_field > 0.4 æ—¶ï¼Œç³»ç»Ÿå¯é€šè¿‡èµ„æºé€šé“æ¢å¤ä¾›ç»™"

3. **HUA_HUO_GE (åŒ–ç«æ ¼)**
   - è§¦å‘æ¡ä»¶: "å½“å¤©å¹²äº”åˆï¼ˆå¦‚æˆŠç™¸ï¼‰å­˜åœ¨ä¸”fire_field > 0.5 æ—¶ï¼Œè§¦å‘åŒ–å­¦ç›¸å˜é€»è¾‘"
   - èƒ½é‡æ–¹ç¨‹: `E_transformation = fire_field Ã— (1 - |earth_field - water_field|) Ã— 100`
   - ç›¸ä½å…³ç³»: "åŸå§‹å…ƒç´ ï¼ˆæˆŠåœŸ/ç™¸æ°´ï¼‰é€šè¿‡åˆåŒ–å¼•ä¿¡è½¬åŒ–ä¸ºå•ä¸€èƒ½é‡åœºï¼ˆç«ï¼‰"
   - ä¿®æ­£æœºåˆ¶: "å¦‚æœç¯å¢ƒæŠ‘åˆ¶ï¼ˆæ°´ç¯å¢ƒï¼‰ï¼Œç›¸å˜å—é˜»ï¼›å¦‚æœç¯å¢ƒä¿ƒè¿›ï¼ˆç«ç¯å¢ƒï¼‰ï¼Œç›¸å˜æˆåŠŸ"
   - åç¼©é˜ˆå€¼: 0.7
   - æ¢å¤è·¯å¾„: "ç¯å¢ƒæ¿€æ´»ï¼šgeo_infoåŒ…å«'ç«åœ°'æ—¶ï¼Œç›¸å˜æˆåŠŸç‡æå‡è‡³0.9"

4. **JIAN_LU_YUE_JIE (å»ºç¦„æœˆåŠ«)**
   - è§¦å‘æ¡ä»¶: "å½“æ—¥ä¸»åœ¨æœˆä»¤å¾—ç¦„ä¸”æ¯”åŠ«æ•°é‡ >= 2 æ—¶ï¼Œè§¦å‘çƒ­åŠ›å­¦æ­£åé¦ˆçˆ†ç‚¸"
   - èƒ½é‡æ–¹ç¨‹: `E_explosion = (bi_jie_count / 4.0) Ã— (1 - phase_coherence) Ã— 100`
   - ç›¸ä½å…³ç³»: "æ¯”åŠ«è¿‡æ—ºå¯¼è‡´èƒ½é‡å¯†åº¦ç¬é—´è¶…è¿‡æ™¶æ ¼æ‰¿è½½ä¸Šé™"
   - ä¿®æ­£æœºåˆ¶: "é€šè¿‡è´¢æ˜Ÿï¼ˆåœŸ/é‡‘ï¼‰ä½œä¸ºæ•£çƒ­è·¯å¾„ï¼Œå°†å†—ä½™èƒ½é‡è½¬åŒ–ä¸ºç‰©è´¨è´¢å¯Œç§¯è“„"
   - åç¼©é˜ˆå€¼: 0.8
   - æ¢å¤è·¯å¾„: "è´¢æ˜Ÿç–å¯¼ï¼šearth_field + metal_field > 0.5 æ—¶ï¼Œç³»ç»Ÿå¯é€šè¿‡è´¢å¯Œç§¯ç´¯é‡Šæ”¾èƒ½é‡"

5. **GUAN_YIN_XIANG_SHENG (å®˜å°ç›¸ç”Ÿ)**
   - è§¦å‘æ¡ä»¶: "å½“metal_field > 0.2 ä¸” water_field > 0.3 ä¸” phase_coherence > 0.7 æ—¶ï¼Œè§¦å‘ç¨³æ€å±‚æµæ¨¡å‹"
   - èƒ½é‡æ–¹ç¨‹: `E_laminar = phase_coherence Ã— (metal_field + water_field) Ã— 100`
   - ç›¸ä½å…³ç³»: "å®˜æ˜Ÿï¼ˆé‡‘ï¼‰çš„å‹åŠ›é€šè¿‡å°æ˜Ÿï¼ˆæ°´ï¼‰çš„ä»‹è´¨ï¼Œè¢«å¹³æ»‘å¸æ”¶å¹¶è½¬åŒ–ä¸ºæ—¥ä¸»åŠ¨èƒ½"
   - ä¿®æ­£æœºåˆ¶: "ç³»ç»Ÿç†µå€¼æä½ï¼Œèƒ½é‡ä¼ å¯¼æ•ˆç‡æœ€é«˜ï¼Œæ— éœ€é¢å¤–ä¿®æ­£æœºåˆ¶"
   - åç¼©é˜ˆå€¼: 0.9
   - æ¢å¤è·¯å¾„: "ç¨³æ€ç»´æŒï¼šä¿æŒphase_coherence > 0.7ï¼Œç³»ç»Ÿå¯æŒç»­æ— é˜»åŠ›è·ƒè¿"

6. **YANG_REN_JIA_SHA (ç¾Šåˆƒæ¶æ€)**
   - è§¦å‘æ¡ä»¶: "å½“ç¾Šåˆƒï¼ˆæ—¥ä¸»åŒäº”è¡Œï¼‰å’Œä¸ƒæ€ï¼ˆå…‹æ—¥ä¸»ï¼‰åŒæ—¶å­˜åœ¨ä¸”stress_tensor > 0.7 æ—¶ï¼Œè§¦å‘é«˜å‹åŠ¨æ€å¹³è¡¡"
   - èƒ½é‡æ–¹ç¨‹: `E_balance = stress_tensor Ã— (day_master_field + sha_field) Ã— 100`
   - ç›¸ä½å…³ç³»: "ç¾Šåˆƒï¼ˆå¢å¼ºæ—¥ä¸»ï¼‰å’Œä¸ƒæ€ï¼ˆå…‹æ—¥ä¸»ï¼‰å½¢æˆæç«¯é«˜å‹ä¸‹çš„åŠ¨æ€å¹³è¡¡"
   - ä¿®æ­£æœºåˆ¶: "ç³»ç»Ÿå¤„äºä¸´ç•ŒçŠ¶æ€ï¼Œéœ€è¦ä¿æŒé«˜å‹å¹³è¡¡ï¼Œé¿å…ä»»ä½•ä¸€æ–¹å¤±è¡¡"
   - åç¼©é˜ˆå€¼: 0.9
   - æ¢å¤è·¯å¾„: "å¹³è¡¡ç»´æŒï¼šä¿æŒ|day_master_field - sha_field| < 0.2ï¼Œç³»ç»Ÿå¯åœ¨å±æœºä¸­æåº¦æ‰©å¼ "

7. **CONG_ER_GE (ä»å„¿æ ¼)**
   - è§¦å‘æ¡ä»¶: "å½“æ—¥ä¸»å¼±ä¸”é£Ÿä¼¤ææ—ºï¼ˆé£Ÿä¼¤æ•°é‡ >= 2ï¼‰ä¸”fire_field + earth_field > 0.5 æ—¶ï¼Œè§¦å‘ç­‰ç¦»å­å–·æ³‰æ¨¡å‹"
   - èƒ½é‡æ–¹ç¨‹: `E_flare = (fire_field + earth_field) Ã— (shi_shang_count / 4.0) Ã— 100`
   - ç›¸ä½å…³ç³»: "é£Ÿä¼¤ï¼ˆç«/åœŸï¼‰ä½œä¸ºè¾“å‡ºé€šé“ï¼Œå½¢æˆç­‰ç¦»å­å–·æ³‰èˆ¬çš„èƒ½é‡å–·å‘"
   - ä¿®æ­£æœºåˆ¶: "åœ¨ç«ç¯å¢ƒä¸­å¾—åˆ°å……åˆ†æ¿€æ´»ï¼Œåœ¨å¯’æ€§ç¯å¢ƒä¸‹é­é‡å†·å‡"
   - åç¼©é˜ˆå€¼: 0.85
   - æ¢å¤è·¯å¾„: "ç¯å¢ƒæ¿€æ´»ï¼šgeo_infoåŒ…å«'ç«åœ°'æ—¶ï¼Œæ‰åå¾—åˆ°å……åˆ†é‡Šæ”¾ï¼›åŒ…å«'è¿‘æ°´'æ—¶ï¼Œéœ€è¦å¯»æ‰¾æ¿€æ´»é€šé“"

### âœ… Task 3.2: é‡æ„Promptæ³¨å…¥å¼•æ“

**æ–‡ä»¶**: `core/subjects/neural_router/prompt_generator.py`

**æ ¸å¿ƒåŠŸèƒ½**:
1. **æå–æ ¼å±€å…¬ç†** (`_extract_pattern_axioms`)
   - ä»æ³¨å†Œè¡¨è¯»å–æ¿€æ´»æ ¼å±€çš„ç‰©ç†å…¬ç†
   - æŒ‰ä¼˜å…ˆçº§æ’åº

2. **æ„å»ºç›¸å¹²æ€§æŒ‡ä»¤** (`_build_coherence_instructions`)
   - åº”åŠ›ä¼˜å…ˆåŸåˆ™
   - åŠ¨é‡ä¼˜å…ˆåŸåˆ™
   - ä¼˜å…ˆçº§æ’åº
   - æƒé‡åç¼©

3. **ç”Ÿæˆé€»è¾‘å†…è”Prompt** (`generate_inline_prompt`)
   - åˆå¹¶ç‰¹å¾å‘é‡æ•°æ®
   - åˆå¹¶æ ¼å±€å…¬ç†å®šä¹‰
   - åˆå¹¶ç›¸å¹²æ€§æŒ‡ä»¤
   - åˆå¹¶åŸå§‹ç»“æ„åŒ–æ•°æ®

**Promptç»“æ„**:
```
ã€QGA V25.0 é€»è¾‘å†…è”æŒ‡ä»¤åŒ… (Logic Inlining)ã€‘
ã€ç‰¹å¾å‘é‡æ•°æ® (Feature Vector)ã€‘
ã€æ¿€æ´»æ ¼å±€çš„ç‰©ç†å…¬ç† (Physical Axioms)ã€‘
ã€æ ¼å±€ç›¸å¹²æ€§å¤„ç†å‡†åˆ™ (Coherence Instructions)ã€‘
ã€åŸå§‹ç»“æ„åŒ–æ•°æ® (Original Structured Data)ã€‘
ã€è¾“å‡ºè¦æ±‚ã€‘
```

### âœ… Task 3.3: æ ¼å±€ç›¸å¹²æ€§æŒ‡ä»¤é›†

**æ–‡ä»¶**: `core/subjects/neural_router/registry.json` (coherence_instructionséƒ¨åˆ†)

**å®šä¹‰çš„æŒ‡ä»¤**:
1. **åº”åŠ›ä¼˜å…ˆ** (stress_priority)
   - é˜ˆå€¼: 0.6
   - ä¼˜å…ˆçº§: 1
   - æè¿°: å½“stress_tensor > 0.6æ—¶ï¼Œä¼˜å…ˆå¤„ç†å†²çªæ ¼å±€ï¼ˆConflictç±»å‹ï¼‰

2. **åŠ¨é‡ä¼˜å…ˆ** (momentum_priority)
   - é˜ˆå€¼: 0.5
   - ä¼˜å…ˆçº§: 2
   - æè¿°: å½“åŠ¨é‡é¡¹æ˜¾ç¤º'é£Ÿç¥â†’è´¢'è½¬åŒ–è¶‹åŠ¿ > 0.5æ—¶ï¼Œä¼˜å…ˆå¤„ç†è¾“å‡ºå‹æ ¼å±€

3. **ä¼˜å…ˆçº§æ’åº** (rank_priority)
   - ä¼˜å…ˆçº§: 3
   - æè¿°: æŒ‰PriorityRankæ’åºï¼ŒRank=1çš„æ ¼å±€ä¼˜å…ˆå¤„ç†

4. **æƒé‡åç¼©** (weight_collapse)
   - æ–¹æ³•: weighted_average
   - å…¬å¼: `weight = base_strength Ã— (1 - entropy_damping)`
   - æè¿°: å¤šä¸ªæ ¼å±€åŒæ—¶æ¿€æ´»æ—¶ï¼Œä½¿ç”¨åŠ æƒå¹³å‡è®¡ç®—ç»¼åˆå½±å“

## é›†æˆçŠ¶æ€

### âœ… æ‰§è¡Œå†…æ ¸é›†æˆ

`execution_kernel.py`å·²æ›´æ–°ï¼š
- âœ… é›†æˆäº†`PromptGenerator`
- âœ… åœ¨`process_bazi_profile`ä¸­ç”Ÿæˆé€»è¾‘å†…è”Prompt
- âœ… å°†Promptä¼ é€’ç»™LLMåˆæˆå™¨ï¼ˆå¦‚æœæ”¯æŒï¼‰

### âœ… æ¨¡å—å¯¼å‡º

`__init__.py`å·²æ›´æ–°ï¼Œå¯¼å‡º`PromptGenerator`ç±»ã€‚

## éªŒè¯æµ‹è¯•

```python
from core.subjects.neural_router.prompt_generator import PromptGenerator
from core.subjects.neural_router.feature_vectorizer import FeatureVectorizer

pg = PromptGenerator()
fv = FeatureVectorizer()

# æµ‹è¯•é€»è¾‘å†…è”Promptç”Ÿæˆ
chart = [('ä¸', 'äº¥'), ('ä¹™', 'å·³'), ('ä¸™', 'åˆ'), ('ç”²', 'åˆ')]
feature = fv.vectorize_bazi(chart, 'ä¸™', geo_info='åŒ—æ–¹/åŒ—äº¬', micro_env=['è¿‘æ°´'])
patterns = [{'id': 'CONG_ER_GE', 'name': 'ä»å„¿æ ¼', 'weight': 0.85}]
structured = {...}

prompt = pg.generate_inline_prompt(patterns, feature, structured)
print(f"âœ… é€»è¾‘å†…è”Promptç”ŸæˆæˆåŠŸï¼Œé•¿åº¦: {len(prompt)} å­—ç¬¦")
```

## æ–‡ä»¶æ¸…å•

- âœ… `core/subjects/neural_router/registry.json` - æ·»åŠ äº†ç‰©ç†å…¬ç†å’Œç›¸å¹²æ€§æŒ‡ä»¤
- âœ… `core/subjects/neural_router/prompt_generator.py` - Promptç”Ÿæˆå™¨ï¼ˆé€»è¾‘å†…è”ç‰ˆæœ¬ï¼‰
- âœ… `core/subjects/neural_router/execution_kernel.py` - æ‰§è¡Œå†…æ ¸ï¼ˆå·²é›†æˆPromptç”Ÿæˆå™¨ï¼‰
- âœ… `core/subjects/neural_router/__init__.py` - æ¨¡å—å¯¼å‡ºï¼ˆå·²æ›´æ–°ï¼‰

## æŠ€æœ¯ç‰¹ç‚¹

1. **ç‰©ç†å…¬ç†åŒ–**: æ¯ä¸ªæ ¼å±€éƒ½æœ‰æ˜ç¡®çš„è§¦å‘æ¡ä»¶ã€èƒ½é‡æ–¹ç¨‹ã€ç›¸ä½å…³ç³»
2. **é€»è¾‘å†…è”**: å°†æ‰€æœ‰ä¿¡æ¯åˆå¹¶æˆé«˜å¯†åº¦æŒ‡ä»¤å‹ç¼©åŒ…ï¼Œå‡å°‘APIè°ƒç”¨æ¬¡æ•°
3. **ç›¸å¹²æ€§å¤„ç†**: å®šä¹‰äº†æ˜ç¡®çš„å¤åˆå¹²æ¶‰å¤„ç†å‡†åˆ™
4. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æ ¼å±€å…¬ç†å’Œç›¸å¹²æ€§æŒ‡ä»¤

## ä¸‹ä¸€æ­¥å·¥ä½œ

1. **æ‰©å±•æ ¼å±€å…¬ç†**: ä¸ºå‰©ä½™çš„æ ¼å±€ï¼ˆå¦‚æœæœ‰ï¼‰æ·»åŠ ç‰©ç†å…¬ç†
2. **ä¼˜åŒ–Promptæ ¼å¼**: æ ¹æ®å®é™…LLMå“åº”ä¼˜åŒ–Promptç»“æ„
3. **é›†æˆæµ‹è¯•**: ä¸LLMåˆæˆå™¨å®Œæ•´é›†æˆï¼ŒéªŒè¯é€»è¾‘å†…è”Promptçš„æ•ˆæœ
4. **æ€§èƒ½ä¼˜åŒ–**: å¯¹äºå¤§é‡æ ¼å±€çš„æƒ…å†µï¼Œä¼˜åŒ–Promptç”Ÿæˆæ€§èƒ½

---

**Phase 3 å®Œæˆï¼é€»è¾‘å…¬ç†æ‰‹å†Œå·²æ³¨å…¥å¼•æ“ï¼Œç¥ç»ç½‘ç»œè·¯ç”±å™¨çš„"å‘åŠ¨æœºæ‰‹å†Œ"å·²å‡†å¤‡å®Œæ¯•ï¼** ğŸš€

