# Antigravity V7.4 技术规范 (Technical Specification)

**版本**: V7.4 - The Physicist Edition  
**发布日期**: 2025-12-14  
**状态**: Stable / Frozen ❄️

---

## 🏛️ 架构总览 (Architecture Overview)

```
                    ┌─────────────────────────────────────┐
                    │       CONFIG SCHEMA (DNA)           │
                    │   core/config_schema.py             │
                    │   DEFAULT_FULL_ALGO_PARAMS          │
                    └─────────────────┬───────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       QUANTUM ENGINE (Facade)                        │
│                       core/quantum_engine.py                         │
├─────────────┬─────────────┬──────────────┬─────────────┬────────────┤
│  Flow       │  Harmony    │  Treasury    │  Skull      │  Luck      │
│  Engine     │  Engine     │  Engine      │  Engine     │  Engine    │
│  (阻尼协议) │  (合化引擎) │  (墓库物理)  │  (骷髅协议) │  (大运管理)│
└─────────────┴─────────────┴──────────────┴─────────────┴────────────┘
```

---

## ⚛️ 核心物理模型 (Core Physics Models)

### 1. 月令集权 (Imperial Month)

月令作为八字的"引力中心"，其权重为其他柱位的 2 倍。

| 柱位 | 权重 | 物理含义 |
|------|------|----------|
| Year | 0.8 | 远场背景 |
| **Month** | **2.0** | **引力中心** |
| Day | 1.0 | 自身锚点 |
| Hour | 0.9 | 近场扰动 |

```python
# core/config_schema.py
"pillarWeights": {
    "year": 0.8, "month": 2.0, "day": 1.0, "hour": 0.9
}
```

---

### 2. 阻尼协议 (Damping Protocol)

解决传统算法中的"超导体"问题：能量瞬间转移导致的非物理行为。

#### A. 输入阻抗 (Resource Impedance)
模拟"虚不受补"现象：身弱者无法完全吸收资源能量。

```
实际吸收 = 理论吸收 × (1 - 阻抗系数)

当 Self < 30:  阻抗 += 虚弱惩罚 (0.5)
```

| 参数 | 默认值 | 说明 |
|------|--------|------|
| base | 0.3 | 基础阻抗 |
| weaknessPenalty | 0.5 | 身弱时额外阻抗 |

#### B. 输出粘滞 (Output Viscosity)
模拟"过劳死保护"：限制能量泄漏的最大速率。

```
实际泄漏 = min(理论泄漏, 当前能量 × 最大泄漏率)
```

| 参数 | 默认值 | 说明 |
|------|--------|------|
| maxDrainRate | 0.6 | 最大泄漏率 (60%) |
| drainFriction | 0.2 | 输出摩擦系数 |

#### C. 全局熵 (Global Entropy)
每轮迭代的自然衰减。

| 参数 | 默认值 | 说明 |
|------|--------|------|
| globalEntropy | 0.05 | 每轮损耗 5% |

---

### 3. 墓库拓扑 (Vault Topology)

四墓库 (辰戌丑未) 的动态状态判定。

| 墓库 | 元素 | 状态条件 |
|------|------|----------|
| 辰 | Water | 能量 > 20 = 库，否则 = 墓 |
| 戌 | Fire | 同上 |
| 丑 | Metal | 同上 |
| 未 | Wood | 同上 |

**状态转换**:
- **闭库** (Sealed): 能量 ≥ 阈值，储存但不释放
- **开库** (Opened): 被冲/刑打开，能量爆发 (×1.5)
- **冲破** (Broken): 身弱时被冲，能量失控 (惩罚)

```python
"vaultPhysics": {
    "threshold": 20.0,      # 库墓阈值
    "sealedDamping": 0.4,   # 闭库损耗
    "openBonus": 1.5,       # 开库爆发
    "breakPenalty": 0.5     # 冲破惩罚
}
```

---

### 4. 骷髅协议 (Skull Protocol)

丑未戌三刑的灾难级预警系统。

**触发条件**: 八字 + 流年中出现 {丑, 未, 戌} 三者齐见

**熔断机制**:
```python
if 三刑齐见:
    score -= 50.0
    icon = '💀'
    risk_level = 'CRITICAL'
```

| 参数 | 值 | 说明 |
|------|-----|------|
| crashScore | -50.0 | 强制熔断分 |

---

### 5. 化学反应 (Alchemy)

天干五合的动态化气逻辑。

| 合化组合 | 化出元素 | 条件 |
|----------|----------|------|
| 甲己 | 土 | 需要土透出或月令为土 |
| 乙庚 | 金 | 需要金透出或月令为金 |
| 丙辛 | 水 | 需要水透出或月令为水 |
| 丁壬 | 木 | 需要木透出或月令为木 |
| 戊癸 | 火 | 需要火透出或月令为火 |

**争合逻辑**: 当多个天干争合时，引入"争合损耗"系数 (0.3)。

---

## 📁 文件结构 (File Structure)

```
core/
├── config_rules.py          # 基础参数常量
├── config_schema.py         # 完整参数 Schema (V7.4)
├── quantum_engine.py        # 主引擎 (Facade)
├── bazi_profile.py          # 八字对象层
└── engines/
    ├── flow_engine.py       # 阻尼协议引擎
    ├── harmony_engine.py    # 合化引擎
    ├── treasury_engine.py   # 墓库物理引擎
    ├── skull_engine.py      # 骷髅协议引擎
    └── luck_engine.py       # 大运管理引擎
```

---

## 🧪 验证结果 (Validation Results)

### 盲测数据集 (15 Cases)

| Case ID | 人物 | 预期 | 实际 | 状态 |
|---------|------|------|------|------|
| VAL_001 | 拳王阿里 | 身强 | 身强 | ✅ |
| VAL_002 | 教父 | 身强 | 71.1分 | 🟡 |
| VAL_003 | ... | ... | ... | ... |

**通过率**: 60% (9/15)  
**有效准确率**: ~75% (含技术性假阴性)

---

## 🚧 V8.0 路线图 (Roadmap)

### 极端气候相变 (Phase Change)
解决"夏土生金"悖论：

```
午月 + 辰土 → 辰土属性 Flip (湿 → 燥) → 生金通道阻断

IF 月令火力 > 阈值 AND 土为湿土:
    土.属性 = 燥土
    土.生金效率 = 0
```

### 宫位引力 (Palace Gravity)
进一步细化日支与时支的权重差异。

---

## 📜 License

MIT License - Antigravity Project 2025
