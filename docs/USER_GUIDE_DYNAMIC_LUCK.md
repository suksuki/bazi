# 🔄 动态大运功能 - 用户指南
## Sprint 5.4 - 如何查看换运点

---

## 📍 在哪里查看？

### 位置
**智能排盘 → 动态流年模拟 → 命运全息图**

---

## 🔍 查看换运点的3种方法

### 方法1: 查看图表中的虚线 (最直观)

**如果有换运**:
- 图表中会出现白色虚线
- 虚线上方标注: 🔄 换运
- 显示新大运名称（如"戊辰"）

**如果没有虚线**:
- 说明12年内未换运
- 大运保持稳定

### 方法2: 查看信息提示框

**在图表上方**会显示：

**有换运时**:
```
🔄 检测到 1 个换运点：
  • 2034年: 丁卯 → 戊辰
```

**无换运时**:
```
ℹ️ 12年内未检测到换运点（大运保持稳定）
当前大运: 丁卯
```

### 方法3: 打开调试面板 (最详细)

**步骤**:
1. 滚动到图表下方
2. 找到 **🔄 大运动态检测 (Luck Progression Debug)**
3. 点击展开

**显示内容**:
- 模拟年份范围
- 检测到的换运点数量
- 每次换运的详细信息
- 全程大运名称

---

## ❓ 常见情况

### 情况1: 看不到虚线

**可能原因**:
1. ✅ **12年内确实未换运** (最常见)
   - 大运每10年一换
   - 您可能在大运中期
   
2. ⚠️ **出生信息不完整**
   - 系统使用默认值计算
   - 可能与实际不符

3. ⚠️ **计算失败**
   - fallback到静态大运

**解决方法**: 查看调试面板确认状态

### 情况2: 有虚线但位置不对

**检查**:
- 出生时间是否准确
- 性别设置是否正确
- 大运是否顺排/逆排

---

## 🎯 如何判断是否应该有换运？

### 快速估算

**大运起运**:
- 通常在3-8岁之间起运
- 每10年换一次

**例子**:
```
出生: 1990年
起运: 1995年 (5岁)
大运: 1995-2004, 2005-2014, 2015-2024, 2025-2034

2024-2035模拟:
→ 会在2025年检测到换运!
```

---

## 🔧 技术说明

### 当前实现

**动态计算**: ✅
- 使用lunar_python自动计算
- 每年动态查找所属大运
- 自动检测换运点

**Fallback机制**: ✅
- 如计算失败，使用静态大运
- 保证系统稳定性

**可视化**: ✅
- 图表虚线标记
- 信息提示框
- 调试面板

### 需要的信息

**必需**:
- 出生年
- 出生月
- 出生日
- 出生时
- 性别

**当前限制**:
- 如果信息不完整，使用默认值
- 默认值可能导致计算不准确

---

## 💡 使用建议

### 如果看到虚线

**说明**:
- 系统成功检测到换运
- 虚线前后的预测使用不同大运
- 预测更加精确

**注意**:
- 查看新旧大运的差异
- 换运年份运势可能有转折

### 如果没看到虚线

**两种可能**:

1. **正常情况** (大运稳定)
   - 12年内确实未换运
   - 预测准确性不受影响

2. **需要检查** (信息不足)
   - 打开调试面板查看
   - 确认使用的大运是否正确

---

## 📊 示例场景

### 场景A: 有换运 (2034年)

**显示**:
```
2024-2033: 正常曲线
2034: ┊虚线标记
      🔄 换运
      戊辰
2034-2035: 可能有变化
```

**提示框**:
```
🔄 检测到 1 个换运点：
  • 2034年: 丁卯 → 戊辰
```

### 场景B: 无换运

**显示**:
```
2024-2035: 平滑曲线，无虚线
```

**提示框**:
```
ℹ️ 12年内未检测到换运点
当前大运: 丁卯
```

---

## 🎓 进阶说明

### 换运的意义

**大运影响**:
- 占整体运势约40%
- 流年占约60%
- 换运意味着基础运势改变

**为何重要**:
- 从忌神运→喜神运: 整体提升
- 从喜神运→忌神运: 需要谨慎

### 检测原理

```python
For each year:
  1. 计算当年所属大运
  2. 与上一年对比
  3. 如不同 → 标记换运点
  4. 绘制虚线
```

---

## ✅ 快速检查清单

使用前检查:
- [ ] 打开智能排盘
- [ ] 进入动态流年模拟
- [ ] 查看图表
- [ ] 检查信息提示框
- [ ] 如有疑问，打开调试面板

---

**如果还是看不到虚线，很可能是12年内确实未换运！这是正常的！** ✅

---

**最后更新**: 2025-12-13  
**版本**: V5.4 Flux
