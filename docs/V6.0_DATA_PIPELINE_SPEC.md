
# Antigravity Data Pipeline V6.0 Specification
# Target: Forum Mining & Logic Extraction

## Pipeline A: The Miner (Forum Data Ingestion)

### 1. Data Source Strategy
To comply with ethical scraping guidelines and technical feasibility:
- We will NOT scrape live forums directly in this phase due to captcha/login walls.
- **Strategy**: We will simulate the pipeline using a "Drop Folder" monitoring system (`data/raw_forums/`).
- User acts as the "Crawler": User saves forum threads (Ctrl+S or Copy-Paste) into text files in this folder.
- **System**: Automatically watches, processes, and structured this raw text.

### 2. The Processor (Class: `ForumMiner`)
Location: `learning/forum_miner.py`

#### A. Pre-Processing & Filter
- Input: Raw Text Dump of a Thread.
- **Regex Logic**:
  - Detect interaction density: Count occurrences of "楼主" or "Feedback" patterns.
  - Detect Bazi Chart: Look for "年" "月" "日" "时" clusters or 8-char blocks.

#### B. NLP Extraction (LLM-Based)
Since forum text is unstructured slang ("神准", "没什么感觉"), we delegate the heavy lifting to the LLM (TheoryMiner extension).

**Prompt Design**:
```text
Role: Bazi Data Engineer
Task: Analyze this forum thread.
1. Extract the Bazi Chart (Standardize to JSON).
2. Extract Verified Events only (Feedback confirmed by OP).
3. Ignore unverified guesses by other users.
Input: <Thread_Text>
Output: JSON {bazi, verified_timeline: [{year, event, score, raw_text}]}
```

#### C. Validation & Storage
- Filter out cases where `feedback_score` is neutral (0.0). Only keep Strong Positive/Negative signals for training.
- Save to `LearningDB` under a new source type `forum_thread`.

### 3. Integration with Flux Engine
- **Feedback Loop**: 
  - If a "Fire Period" (e.g. Bing Wu Year) caused "Bad event" despite being a "Useful God" in theory -> This is a **Negative Sample**.
  - The `ModelTrainer` will use this to penalize the weight of Fire for this chart structure.

## Pipeline B: The Logic Distiller (Rule Extraction)
*(To be implemented in next phase, focus on Miner first per user request)*

## Implementation Plan
1. Create `learning/forum_miner.py`.
2. Update `LearningDB` schema (if needed) to support `verified_timeline`.
3. Create a CLI tool `mine_forum.py` to batch process text files.
