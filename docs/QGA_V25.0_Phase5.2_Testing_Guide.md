# QGA V25.0 Phase 5.2 压力测试指南

## 概述

Phase 5.2 实现了1000个复杂样本的大规模压力测试，用于验证神经矩阵路由系统在处理复合冲突态时的稳定性。

## 测试脚本

### 1. 小规模测试（快速验证）

**文件**: `tests/batch_pressure_test_small.py`

**用途**: 先运行10个样本验证流程，确认无误后再运行完整测试

**运行方式**:
```bash
python3 tests/batch_pressure_test_small.py
```

### 2. 完整压力测试（1000样本）

**文件**: `tests/batch_pressure_test_v25.py`

**用途**: 运行完整的1000样本压力测试

**运行方式**:
```bash
python3 tests/batch_pressure_test_v25.py
```

## 测试内容

### 样本生成策略

1. **单格局样本（70%）**: 700个样本，每个样本包含一个格局
2. **复合冲突态样本（30%）**: 300个样本，每个样本包含两个冲突格局

### 复合冲突态组合

- 伤官见官 + 羊刃架杀
- 枭神夺食 + 建禄月劫
- 化火格 + 官印相生
- 从儿格 + 枭神夺食

### 环境配置

- 北方/北京 + 近水（水旺环境）
- 南方/深圳（火旺环境）
- 东方/上海 + 近水（木旺环境）
- 西方/西安（金旺环境）
- 中央/郑州（土旺环境）

## 验证指标

### 1. 逻辑归一化

- **检查**: 权重总和是否在0.95-1.05范围内
- **指标**: `weight_normalization_errors` - 权重归一化错误数

### 2. 语义自愈率

- **检查**: 当稳定性 < 0.2 时，LLM是否准确识别为"崩态"
- **指标**: `semantic_healing_errors` - 语义自愈错误数

### 3. API健壮性

- **检查**: API调用是否成功，是否有错误响应
- **指标**: `api_errors` - API错误数

## 输出结果

### 1. 控制台输出

实时显示：
- 样本生成进度
- 处理进度（每100个样本）
- 最终统计报告

### 2. 日志文件

**位置**: `logs/batch_pressure_test.log`

包含详细的处理日志和错误信息

### 3. 测试报告

**位置**: `logs/batch_pressure_test_report.json`

包含：
- 测试摘要（总数、成功数、失败数、离群数）
- 验证指标（权重归一化错误、语义自愈错误、API错误）
- 性能指标（总耗时、平均处理时间、吞吐量、Token估算）

### 4. 离群样本归档

**位置**: `logs/outliers_v25.json`

包含所有被识别为离群样本的详细信息，用于V26.0的微调数据集

## 性能指标

- **并发线程数**: 默认4个（可在代码中调整）
- **预计耗时**: 
  - 10样本: 约1-2分钟
  - 1000样本: 约2-3小时（取决于LLM响应速度）

## 注意事项

1. **LLM服务**: 确保Ollama服务正在运行，且已拉取qwen2.5:3b模型
2. **资源消耗**: 1000样本测试会消耗大量Token，请确保有足够的API配额
3. **日志目录**: 确保`logs/`目录存在，否则会创建
4. **中断恢复**: 如果测试中断，需要重新运行（当前不支持断点续传）

## 结果解读

### 成功标准

- **成功率**: > 95%
- **权重归一化错误**: < 1%
- **语义自愈错误**: < 5%
- **API错误**: < 1%

### 离群样本处理

如果离群样本率 > 5%，需要：
1. 检查`logs/outliers_v25.json`中的离群样本
2. 分析失败原因
3. 调整神经路由器的参数或逻辑
4. 重新运行测试

## 下一步

测试完成后：
1. 分析测试报告，识别系统瓶颈
2. 优化离群样本的处理逻辑
3. 将离群样本作为V26.0的训练数据
4. 更新文档和代码注释

