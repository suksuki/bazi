# 八字旺衰参数分组清单

## 📊 参数分组概览

| 组别 | 参数数量 | 优先级 | 影响阶段 | 调优顺序 |
|------|---------|--------|----------|----------|
| **组1: 基础物理参数** | 12个 | ⭐⭐⭐⭐⭐ | Phase 1 | 1 |
| **组2: 交互关系参数** | 7个 | ⭐⭐⭐⭐ | Phase 2 | 2 |
| **组3: 传播机制参数** | 3个 | ⭐⭐⭐ | Phase 3 | 3 |
| **组4: 判定阈值参数** | 5个 | ⭐⭐⭐⭐⭐ | Phase 5 | 4 |
| **硬编码参数** | 9个 | ⭐⭐ | 各阶段 | - |

---

## 组1: 基础物理参数（Phase 1）

### 1.1 宫位权重 (Pillar Weights)

**配置路径**: `config['physics']['pillarWeights']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `year` | 0.8 | 0.7-0.9 | 低 |
| `month` | 1.2 | **1.0-1.5** | **最高** |
| `day` | 1.0 | 0.9-1.1 | 中 |
| `hour` | 0.9 | 0.8-1.0 | 低 |

**调优建议**: 先调 `month`，再调 `day` 和 `hour`

### 1.2 季节权重 (Season Weights)

**配置路径**: `config['physics']['seasonWeights']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| 得令系数 | 1.5 | **1.3-1.8** | **高** |
| 得生系数 | 1.2 | 1.1-1.3 | 中 |
| 被克系数 | 0.5 | 0.3-0.7 | 中 |

**调优建议**: 先调得令系数，再调得生和被克系数

### 1.3 通根系数 (Rooting Weight)

**配置路径**: `config['structure']['rootingWeight']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `rootingWeight` | 1.0 | **1.0-1.5** | **高** |

**调优建议**: 通根是身强的重要指标，建议重点调优

### 1.4 自坐强根 (Same Pillar Bonus)

**配置路径**: `config['structure']['samePillarBonus']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `samePillarBonus` | 1.2 | 1.1-1.3 | 中 |

### 1.5 透干加成 (Exposed Boost)

**配置路径**: `config['structure']['exposedBoost']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `exposedBoost` | 1.5 | **1.3-2.0** | **高** |

**调优建议**: 透干是能量爆发的重要机制，建议重点调优

### 1.6 藏干比例 (Hidden Stem Ratios)

**配置路径**: `config['physics']['hiddenStemRatios']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `hiddenStemRatios` | 0.3 | 0.2-0.4 | 中 |

### 1.7 空亡惩罚 (Void Penalty)

**配置路径**: `config['structure']['voidPenalty']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `voidPenalty` | 0.5 | 0.3-0.7 | 低 |

---

## 组2: 交互关系参数（Phase 2）

### 2.1 五行生克权重

**配置路径**: `config['flow']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `generationEfficiency` | 1.2 | 1.0-1.5 | 中 |
| `controlImpact` | 5.0 | **3.0-7.0** | **最高** |

**调优建议**: `controlImpact` 是核心参数，建议重点调优

### 2.2 润局效应 (Moisture Boost)

**配置路径**: `config['flow']['earthMetalMoistureBoost']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `earthMetalMoistureBoost` | 1.5 | 1.0-2.0 | 低 |

### 2.3 天干五合 (Stem Five Combination)

**配置路径**: `config['interactions']['stemFiveCombination']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `threshold` | 0.7 | **0.6-0.8** | **高** |
| `bonus` | 2.0 | **1.5-2.5** | **高** |
| `penalty` | 0.3 | 0.2-0.5 | 中 |
| `jealousyDamping` | 0.3 | 0.2-0.4 | 低 |

**调优建议**: 先调 `threshold` 和 `bonus`

### 2.4 地支合局 (Branch Combo)

**配置路径**: `config['interactions']['comboPhysics']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `trineBonus` | 2.5 | 2.0-3.0 | 中 |
| `halfBonus` | 1.5 | 1.2-1.8 | 低 |
| `directionalBonus` | 3.0 | 2.5-3.5 | 中 |
| `resolutionCost` | 0.1 | 0.05-0.15 | 低 |

### 2.5 冲的折损 (Clash Damping)

**配置路径**: `config['interactions']['branchEvents']['clashDamping']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `clashDamping` | 0.5 | **0.3-0.7** | **中** |

### 2.6 距离衰减 (Spatial Decay)

**配置路径**: `config['flow']['spatialDecay']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `gap1` | 0.6 | 0.5-0.7 | 低 |
| `gap2` | 0.3 | 0.2-0.4 | 低 |

### 2.7 GAT动态注意力

**配置路径**: `config['gat']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `use_gat` | True | - | - |
| `attention_dropout` | 0.29 | **0.2-0.4** | **高** |
| `gat_mix_ratio` | 0.5 | 0.3-0.7 | 中 |

**调优建议**: `attention_dropout` 是核心参数，建议重点调优

---

## 组3: 传播机制参数（Phase 3）

### 3.1 阻尼系数 (Damping)

**位置**: `propagate()` 参数

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `damping` | 0.9 | 0.8-0.95 | 中 |

### 3.2 食伤泄耗惩罚 (Output Drain Penalty)

**配置路径**: `config['flow']['outputDrainPenalty']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `outputDrainPenalty` | 2.0 | **1.5-2.5** | **高** |

**调优建议**: 食伤泄耗是身弱的重要机制，建议重点调优

### 3.3 全局熵增 (Global Entropy)

**配置路径**: `config['flow']['globalEntropy']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `globalEntropy` | 0.05 | 0.03-0.08 | 低 |

---

## 组4: 判定阈值参数（Phase 5）

### 4.1 Sigmoid参数

**配置路径**: `config['strength']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `energy_threshold_center` | 2.89 | **2.5-3.5** | **最高** |
| `phase_transition_width` | 10.0 | **8.0-12.0** | **高** |

**调优建议**: `energy_threshold_center` 是核心参数，建议重点调优

### 4.2 从格阈值 (Follower Threshold)

**配置路径**: `config['strength']['follower_threshold']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `follower_threshold` | 0.15 | 0.1-0.2 | 中 |

### 4.3 判定阈值 (Judgment Thresholds) [V12.1]

**配置路径**: `config['strength']`

| 参数 | 当前值 | 建议范围 | 调优优先级 |
|------|--------|----------|------------|
| `weak_score_threshold` | 40.0 | **35.0-45.0** | **高** |
| `strong_score_threshold` | 50.0 | **45.0-55.0** | **高** |
| `strong_probability_threshold` | 0.60 | **0.55-0.65** | **高** |

**调优建议**: 这三个参数是最终判定的核心，建议重点调优

---

## 硬编码参数（建议参数化）

以下参数当前是硬编码的，建议参数化以便调优：

| 参数 | 当前值 | 位置 | 建议参数化 |
|------|--------|------|------------|
| 季节主导锁定 | 1.3 | Phase 1 | `seasonal_dominance_boost` |
| 自刑惩罚 | 0.5 | Phase 1 | `self_punishment_penalty` |
| 大运地支权重 | 1.2×月令 | Phase 1 | `dayun_branch_multiplier` |
| 大运天干权重 | 0.8×月令 | Phase 1 | `dayun_stem_multiplier` |
| 流年权力系数 | 2.0 | Phase 1 | `liunian_power` |
| 虚浮比劫惩罚 | 0.2 | Phase 4 | `floating_peer_penalty` |
| 阳刃能量加成 | 1.5 | Phase 4 | `yangren_energy_boost` |
| 自刑根气惩罚 | 0.2 | Phase 4 | `self_punishment_root_penalty` |
| 流向加成倍数 | 10.0 | Phase 4 | `flow_bonus_multiplier` |
| 流年能量衰减 | 0.9 | Phase 3 | `liunian_decay_rate` |

---

## 调优工作流

### 阶段1: 基础参数调优（组1）

**目标**: 优化初始能量计算

1. **月令权重** (`pillarWeights.month`): 1.0 → 1.1 → 1.2 → 1.3 → 1.4 → 1.5
2. **季节权重** (得令系数): 1.3 → 1.4 → 1.5 → 1.6 → 1.7 → 1.8
3. **通根系数** (`rootingWeight`): 1.0 → 1.1 → 1.2 → 1.3 → 1.4 → 1.5
4. **透干加成** (`exposedBoost`): 1.3 → 1.4 → 1.5 → 1.6 → 1.7 → 2.0

**测试方法**: 批量验证所有案例，记录准确率

### 阶段2: 交互参数调优（组2）

**目标**: 优化能量传播关系

1. **克制影响** (`controlImpact`): 3.0 → 4.0 → 5.0 → 6.0 → 7.0
2. **天干五合阈值** (`threshold`): 0.6 → 0.65 → 0.7 → 0.75 → 0.8
3. **天干五合增益** (`bonus`): 1.5 → 1.75 → 2.0 → 2.25 → 2.5
4. **GAT注意力** (`attention_dropout`): 0.2 → 0.25 → 0.29 → 0.35 → 0.4

**测试方法**: 批量验证所有案例，记录准确率

### 阶段3: 传播参数调优（组3）

**目标**: 优化能量传播过程

1. **食伤泄耗** (`outputDrainPenalty`): 1.5 → 1.75 → 2.0 → 2.25 → 2.5
2. **全局熵增** (`globalEntropy`): 0.03 → 0.04 → 0.05 → 0.06 → 0.08

**测试方法**: 批量验证所有案例，记录准确率

### 阶段4: 判定参数调优（组4）

**目标**: 优化最终判定逻辑

1. **相变临界点** (`energy_threshold_center`): 2.5 → 2.7 → 2.89 → 3.1 → 3.3 → 3.5
2. **概率波带宽** (`phase_transition_width`): 8.0 → 9.0 → 10.0 → 11.0 → 12.0
3. **弱判定阈值** (`weak_score_threshold`): 35.0 → 37.5 → 40.0 → 42.5 → 45.0
4. **强判定阈值** (`strong_score_threshold`): 45.0 → 47.5 → 50.0 → 52.5 → 55.0
5. **强判定概率阈值** (`strong_probability_threshold`): 0.55 → 0.575 → 0.60 → 0.625 → 0.65

**测试方法**: 批量验证所有案例，记录准确率和误判分析

### 阶段5: 综合调优

**目标**: 微调所有参数，找到全局最优

1. 使用网格搜索或贝叶斯优化
2. 回归测试验证
3. 记录最优参数配置

---

## 参数调优检查清单

### 调优前

- [ ] 备份当前配置文件
- [ ] 记录当前准确率基线
- [ ] 准备测试案例集（包含各种格局）
- [ ] 设置回归测试阈值

### 调优中

- [ ] 每次只调一个参数
- [ ] 记录每次调优的准确率变化
- [ ] 分析误判案例，找出规律
- [ ] 使用版本控制记录参数变更

### 调优后

- [ ] 验证所有案例的准确率
- [ ] 检查回归测试是否通过
- [ ] 记录最优参数配置
- [ ] 更新文档说明

---

**文档版本**: V1.0  
**最后更新**: 2025-01-XX  
**维护者**: Bazi Predict Team

