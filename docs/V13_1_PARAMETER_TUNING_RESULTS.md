# V13.1 参数调优结果报告

## 执行时间
2025-01-XX

## 核心修复

### 1. 修复季节系数未应用问题
**问题**: `self.bazi` 在 `initialize_nodes` 中未设置，导致季节系数判断条件 `if hasattr(self, 'bazi') and self.bazi and len(self.bazi) > 1:` 失败。

**修复**: 在 `initialize_nodes` 方法开头添加 `self.bazi = bazi`

### 2. 参数优化结果

经过多次迭代调优，找到的最佳参数组合：

| 参数 | 原始值 | V13.1 默认值 | 最佳值 | 说明 |
|------|--------|-------------|--------|------|
| 泄气系数 (xiu) | 0.80 | 0.85 | **0.90** | 提升泄气场景的能量 |
| 被克系数 (si) | 0.40 | 0.50 | **0.45** | 进一步惩罚被克场景 |
| 自坐强根加成 | 1.6 | 1.8 | **3.0** | 显著提升自坐强根优势 |
| 日柱权重 | 1.2 | 1.2 | **1.35** | 解决Group C倒挂问题 |

## 验证结果

### 当前状态（参数：xiu=0.90, si=0.45, samePillarBonus=3.0, dayWeight=1.35）

| Group | 状态 | 详细结果 |
|-------|------|----------|
| **Group A (月令)** | ✅ **通过** | A3(18.97) > A4(16.07), P = **95.2%** ✅ |
| **Group B (通根)** | ❌ **失败** | B3(36.69) > B2(26.48), P = **83.2%** (差1.8%) |
| **Group C (宫位)** | ✅ **通过** | C2(84.36) > C3(71.43), P = **94.0%** ✅ |

**总损失**: 0.03（从初始的 47.71 降低了 **99.94%**）

## 问题分析

### Group B 未通过原因

1. **均值差距足够大**: B3 (36.69) vs B2 (26.48)，差距 10.21，比例 1.39
2. **标准差过大**: B3 标准差 9.08，B2 标准差 5.47
3. **不确定性影响**: 高标准差导致概率分布重叠，降低 P(B3 > B2)

**建议**: 
- 进一步降低 B3 的不确定度（可能需要调整 `samePillarBonus` 应用时的 `std_boost`）
- 或者接受 83.2% 的结果（已经很接近 85%）

## 参数建议

如果要在 `config_schema.py` 中更新默认值：

```python
"physics": {
    "seasonWeights": { 
        "wang": 1.20, 
        "xiang": 1.00, 
        "xiu": 0.90,      # V13.1: 从0.85提升到0.90
        "qiu": 0.60, 
        "si": 0.45        # V13.1: 从0.50降低到0.45
    },
    "pillarWeights": {
        "year": 0.7,
        "month": 1.2,
        "day": 1.35,       # V13.1: 从1.2提升到1.35
        "hour": 0.9
    }
},
"structure": {
    "samePillarBonus": 3.0  # V13.1: 从1.8提升到3.0
}
```

## 下一步

1. ✅ 已修复季节系数未应用问题
2. ✅ Group A 和 Group C 已通过
3. ⚠️ Group B 接近通过（83.2%），可考虑：
   - 进一步调整不确定度机制
   - 或接受当前结果（83.2% 已经很接近 85%）

