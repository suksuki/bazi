# QGA V25.0 Phase 5.1 UI溯源面板实现文档

## 实现概述

在 `ui/pages/profile_audit.py` 中添加了 **Neural Route Trace（神经矩阵路由溯源）** 组件，用于可视化V25.0神经矩阵路由系统的处理过程。

## 新增功能

### 1. 特征向量指纹雷达图
- **位置**: 在审计报告中的"神经矩阵路由溯源"部分
- **功能**: 显示五行场强分布（elemental_fields_dict）
- **可视化**: Plotly雷达图，展示金、木、水、火、土的场强值
- **关键指标**:
  - 应力张量 (stress_tensor)
  - 相位一致性 (phase_coherence)
  - 主导元素

### 2. 逻辑权重坍缩热力图
- **位置**: 特征向量指纹下方
- **功能**: 显示各格局的权重贡献百分比
- **可视化**: Plotly水平条形图（热力图风格）
- **特点**:
  - 自动按权重排序（从高到低）
  - 颜色映射表示权重强度
  - 显示权重归一化验证（应在95-105%范围内）

### 3. 能量状态报告波形图
- **位置**: 权重坍缩下方
- **功能**: 根据系统稳定性生成不同的波形
- **可视化**: Plotly折线图，根据稳定性状态显示不同波形：
  - **崩态** (< 0.3): 高频震荡波形（红色）
  - **临界态** (0.3-0.5): 中频波动波形（橙色）
  - **波动态** (> 0.5, 低相干性): 低频波动波形（黄色）
  - **稳态** (> 0.7, 高相干性): 平滑传导波形（青色）
- **关键指标**:
  - 系统稳定性
  - 临界状态
  - 能量流向

### 4. 处理元数据详情
- **位置**: 可折叠的expander中
- **功能**: 显示神经路由器的处理元数据
- **包含信息**:
  - 格局数
  - 综合SAI
  - Prompt长度
  - 场强阈值
  - 相干权重
  - 熵值阻尼
  - 矩阵路由信息

## 数据来源

UI组件从审计结果中读取以下字段：
- `neural_router_metadata`: 包含特征向量和处理元数据
- `logic_collapse`: 格局权重坍缩结果
- `energy_state_report`: 能量状态报告

## 触发条件

当审计结果中包含以下任一字段时，显示Neural Route Trace组件：
- `neural_router_metadata`
- `logic_collapse`

## 样式设计

- **主题**: 与现有UI保持一致（深色背景、金色标题、青色强调）
- **布局**: 使用Streamlit的列布局和expander
- **交互**: Plotly图表支持缩放、悬停等交互

## 注意事项

1. **数据依赖**: 需要ProfileAuditController在审计结果中包含neural_router的处理结果
2. **向后兼容**: 如果审计结果中没有neural_router数据，组件不会显示（不影响现有功能）
3. **性能**: Plotly图表渲染性能良好，但大量数据时可能需要优化

## 下一步

1. **集成Neural Router**: 确保ProfileAuditController在启用LLM时调用neural_router
2. **测试**: 使用蒋柯栋档案测试UI组件显示
3. **优化**: 根据实际使用情况优化图表样式和交互

