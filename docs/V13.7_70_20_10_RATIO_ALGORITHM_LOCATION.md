# V13.7 70/20/10 æ¯”ä¾‹ç®—æ³•ä½ç½®è¯´æ˜

**ç”Ÿæˆæ—¥æœŸ**: 2025-12-25  
**é—®é¢˜**: é™æ€æ¨¡å¼ä½¿ç”¨çš„ä¼ ç»Ÿ 70/20/10 æ¯”ä¾‹ç®—æ³•åœ¨å“ªé‡Œï¼Ÿ

---

## ğŸ“ ç®—æ³•ä½ç½®

### ä¸»è¦ä½ç½®ï¼š`core/trinity/core/engines/structural_vibration.py`

**æ–‡ä»¶è·¯å¾„**: `/home/jin/bazi_predict/core/trinity/core/engines/structural_vibration.py`

**ä»£ç ä½ç½®**: ç¬¬ 110-112 è¡Œ

```python
# Apply 0.7/0.2/0.1 Ratio for Main/Sub/Residual
ratios = [0.7, 0.2, 0.1]
ratio = ratios[h_idx] if h_idx < len(ratios) else 0.05
```

---

## ğŸ”¬ ç®—æ³•ç”¨é€”

### åŠŸèƒ½ï¼šæ”¯è—å¹²èƒ½é‡åˆ†é…ï¼ˆVertical Couplingï¼‰

åœ¨ `StructuralVibrationEngine` çš„ `_apply_vertical_coupling` æ–¹æ³•ä¸­ï¼Œç”¨äºè®¡ç®—åœ°æ”¯è—å¹²ï¼ˆHidden Stemï¼‰çš„èƒ½é‡åˆ†é…ï¼š

1. **ä¸»è—å¹²ï¼ˆMainï¼‰**: 70% (0.7)
2. **æ¬¡è—å¹²ï¼ˆSubï¼‰**: 20% (0.2)
3. **ä½™è—å¹²ï¼ˆResidualï¼‰**: 10% (0.1)

### å®Œæ•´ä»£ç ä¸Šä¸‹æ–‡

```110:114:core/trinity/core/engines/structural_vibration.py
                        # Apply 0.7/0.2/0.1 Ratio for Main/Sub/Residual
                        ratios = [0.7, 0.2, 0.1]
                        ratio = ratios[h_idx] if h_idx < len(ratios) else 0.05
                        
                        root_strength += h_weight * ratio * pulse_mult
```

### è°ƒç”¨ä½ç½®

åœ¨ `_apply_vertical_coupling` æ–¹æ³•ä¸­ï¼Œå½“å¤„ç†åœ°æ”¯è—å¹²æ—¶ï¼š

```100:114:core/trinity/core/engines/structural_vibration.py
                # Hidden structure: [(Stem, Weight), ...] 
                # Weight is usually a priority: Main(10), Secondary(3), Tertiary(1)
                for h_idx, (h_stem, h_weight) in enumerate(hidden):
                    h_elem = BaziParticleNexus.STEMS.get(h_stem)[0]
                    if h_elem == stem_elem:
                        # [PATCH] Pulsed Release Logic
                        # If annual_stem 'activates' this hidden stem, increase release efficiency
                        is_pulsed = (h_stem == annual_stem)
                        pulse_mult = 1.5 if is_pulsed else 1.0
                        
                        # Apply 0.7/0.2/0.1 Ratio for Main/Sub/Residual
                        ratios = [0.7, 0.2, 0.1]
                        ratio = ratios[h_idx] if h_idx < len(ratios) else 0.05
                        
                        root_strength += h_weight * ratio * pulse_mult
```

---

## ğŸ”„ ä¸é‡å­å¼¥æ•£æ¨¡å¼çš„å…³ç³»

### é™æ€æ¨¡å¼ vs é‡å­å¼¥æ•£æ¨¡å¼

1. **é™æ€æ¨¡å¼ï¼ˆä¼ ç»Ÿï¼‰**:
   - ä½¿ç”¨å›ºå®šçš„ 70/20/10 æ¯”ä¾‹
   - ä½ç½®: `structural_vibration.py` ç¬¬ 111 è¡Œ
   - ç‰¹ç‚¹: ç®€å•ã€å¿«é€Ÿï¼Œä½†ç²¾åº¦è¾ƒä½

2. **é‡å­å¼¥æ•£æ¨¡å¼ï¼ˆåŠ¨æ€ï¼‰**:
   - ä½¿ç”¨åŸºäºèŠ‚æ°”è¿›åº¦çš„åŠ¨æ€æƒé‡åˆ†é…
   - ä½ç½®: `core/trinity/core/engines/quantum_dispersion.py`
   - ç‰¹ç‚¹: ç²¾åº¦æ›´é«˜ï¼ŒåŸºäºæ­£å¼¦å¼¥æ•£æ¨¡å‹

### é‡å­å¼¥æ•£ç®—æ³•

**æ–‡ä»¶**: `core/trinity/core/engines/quantum_dispersion.py`

**ç®—æ³•**: æ­£å¼¦å¼¥æ•£æ¨¡å‹
- Primary(t)   = sinÂ²(Ï€t/T)           # å³°å€¼åœ¨èŠ‚æ°”ä¸­æœŸ
- Secondary(t) = sinÂ²(Ï€t/T + Ï€/3)     # ç›¸ä½åç§» 60Â°
- Residual(t)  = sinÂ²(Ï€t/T + 2Ï€/3)    # ç›¸ä½åç§» 120Â°

**è¯´æ˜**: é‡å­å¼¥æ•£å¼•æ“ä¼šæ›¿æ¢é™æ€çš„ 70/20/10 æ¯”ä¾‹ï¼Œæ ¹æ®å‡ºç”Ÿæ—¶é—´åœ¨èŠ‚æ°”ä¸­çš„ä½ç½®åŠ¨æ€è®¡ç®—æƒé‡ã€‚

---

## ğŸ“Š å…¶ä»–ç›¸å…³æ¯”ä¾‹é…ç½®

### 1. `hiddenStemRatios` é…ç½®ï¼ˆ60/30/10ï¼‰

**ä½ç½®**: `core/config_schema.py` ç¬¬ 31-33 è¡Œ

```python
"hiddenStemRatios": { 
    "main": 0.60, "middle": 0.30, "remnant": 0.10 
}
```

**ç”¨é€”**: ç”¨äº `phase1_initialization.py` ä¸­çš„è—å¹²èƒ½é‡è®¡ç®—ï¼ˆå£³æ ¸æ¨¡å‹ï¼‰

**æ³¨æ„**: è¿™æ˜¯ **60/30/10** æ¯”ä¾‹ï¼Œä¸ `structural_vibration.py` ä¸­çš„ **70/20/10** ä¸åŒã€‚

### 2. `root_ratios` é…ç½®ï¼ˆ70/20/10ï¼‰

**ä½ç½®**: `core/logic_manifest.json` ç¬¬ 1566 è¡Œ

```json
"root_ratios": [0.7, 0.2, 0.1]
```

**ç”¨é€”**: é€šæ ¹å¢ç›Šè®¡ç®—ä¸­çš„æ¯”ä¾‹é…ç½®

---

## ğŸ¯ UI ä¸­çš„æç¤º

**ä½ç½®**: `ui/pages/quantum_lab.py` ç¬¬ 612 è¡Œ

```python
st.warning("âš ï¸ **é™æ€æ¨¡å¼**: ä½¿ç”¨ä¼ ç»Ÿ 70/20/10 æ¯”ä¾‹ã€‚å»ºè®®å¼€å¯é‡å­å¼¥æ•£æ¨¡å¼ä»¥è·å¾—æ›´é«˜ç²¾åº¦ã€‚")
```

è¿™ä¸ªæç¤ºå‡ºç°åœ¨é‡å­å¼¥æ•£æ¨¡å¼æœªæ¿€æ´»æ—¶ï¼Œæé†’ç”¨æˆ·é™æ€æ¨¡å¼ä½¿ç”¨çš„æ˜¯å›ºå®šçš„ 70/20/10 æ¯”ä¾‹ã€‚

---

## ğŸ“‹ æ€»ç»“

| æ¯”ä¾‹ | ä½ç½® | ç”¨é€” | æ¨¡å¼ |
|------|------|------|------|
| **70/20/10** | `structural_vibration.py:111` | æ”¯è—å¹²èƒ½é‡åˆ†é…ï¼ˆVertical Couplingï¼‰ | é™æ€æ¨¡å¼ |
| **60/30/10** | `config_schema.py:31` | è—å¹²èƒ½é‡è®¡ç®—ï¼ˆå£³æ ¸æ¨¡å‹ï¼‰ | é…ç½®å‚æ•° |
| **åŠ¨æ€æƒé‡** | `quantum_dispersion.py` | åŸºäºèŠ‚æ°”è¿›åº¦çš„åŠ¨æ€åˆ†é… | é‡å­å¼¥æ•£æ¨¡å¼ |

---

**ç»“è®º**: é™æ€æ¨¡å¼ä½¿ç”¨çš„ä¼ ç»Ÿ 70/20/10 æ¯”ä¾‹ç®—æ³•ä½äº `core/trinity/core/engines/structural_vibration.py` ç¬¬ 110-112 è¡Œï¼Œç”¨äºæ”¯è—å¹²èƒ½é‡åˆ†é…ã€‚å½“å¼€å¯é‡å­å¼¥æ•£æ¨¡å¼æ—¶ï¼Œè¿™ä¸ªå›ºå®šæ¯”ä¾‹ä¼šè¢«åŸºäºèŠ‚æ°”è¿›åº¦çš„åŠ¨æ€æƒé‡æ›¿æ¢ã€‚

