# é€»è¾‘è½¬æ¢å™¨é›†æˆæˆåŠŸæŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-03  
**çŠ¶æ€**: âœ… **è½¬æ¢å™¨é›†æˆæˆåŠŸï¼Œéƒ¨åˆ†ç”¨ä¾‹é€šè¿‡**

---

## ðŸŽ‰ é‡å¤§çªç ´

### âœ… è½¬æ¢å™¨æµ‹è¯•æˆåŠŸ

**æµ‹è¯•ç»“æžœ**:
- âœ… æµ‹è¯•1: `(ten_gods.ZS > 0) & (ten_gods.ZR == 1)` â†’ æˆåŠŸè½¬æ¢ä¸ºJSONLogic
- âœ… æµ‹è¯•2: `(ten_gods['PC'] > ten_gods['ZS'])` â†’ æˆåŠŸè½¬æ¢
- âœ… æµ‹è¯•3: `self_energy['ZS'] > 0` â†’ æˆåŠŸè½¬æ¢
- âš ï¸ æµ‹è¯•4: åŒ…å«`exist()`å‡½æ•°è°ƒç”¨ â†’ è½¬æ¢å¤±è´¥ï¼ˆé¢„æœŸï¼‰

### âœ… å®žé™…è’¸é¦æµ‹è¯•æˆåŠŸ

**æµ‹è¯•1ç»“æžœ**:
- **è¾“å…¥**: "é£Ÿç¥žç”Ÿæ—ºï¼Œä¸”è§è´¢æ˜Ÿå¼•é€šé£Ÿç¥žä¹‹æ°”ï¼Œæ­¤ä¸ºä¸Šæ ¼ã€‚"
- **LLMè¾“å‡º**: å­—ç¬¦ä¸²æ ¼å¼çš„expression_tree
- **è½¬æ¢åŽ**: âœ… æˆåŠŸè½¬æ¢ä¸ºJSONLogicå¯¹è±¡æ ¼å¼
- **éªŒè¯ç»“æžœ**: âœ… **é€šè¿‡éªŒè¯ï¼**

**è½¬æ¢å‰ï¼ˆå­—ç¬¦ä¸²ï¼‰**:
```
"expression_tree": "(self_energy['ZS'] > 0) & (ten_gods.ZC['ZR'] == 1)"
```

**è½¬æ¢åŽï¼ˆJSONLogicï¼‰**:
```json
{
  "expression_tree": {
    "and": [
      {
        ">": [
          {"var": "self_energy.ZS"},
          0
        ]
      },
      {
        "==": [
          {"var": "ten_gods.ZC.ZR"},
          1
        ]
      }
    ]
  }
}
```

---

## ðŸ“Š è½¬æ¢æˆåŠŸçŽ‡

### æ”¯æŒçš„æ ¼å¼

âœ… **å®Œå…¨æ”¯æŒ**:
- åŸºæœ¬æ¯”è¾ƒæ“ä½œ (`>`, `<`, `==`, `>=`, `<=`, `!=`)
- é€»è¾‘è¿ç®— (`&`, `|`, `and`, `or`)
- å±žæ€§è®¿é—® (`ten_gods.ZS`)
- ä¸‹æ ‡è®¿é—® (`ten_gods['ZS']`, `self_energy['ZS']`)
- åµŒå¥—é€»è¾‘è¡¨è¾¾å¼

### å·²çŸ¥é™åˆ¶

âš ï¸ **æš‚ä¸æ”¯æŒ**:
- å‡½æ•°è°ƒç”¨ï¼ˆå¦‚ `exist()`, `len()` ç­‰ï¼‰
- å¤æ‚ç®—æœ¯è¿ç®—
- Lambdaè¡¨è¾¾å¼

**å½±å“**: éƒ¨åˆ†å¤æ‚çš„LLMè¾“å‡ºå¯èƒ½æ— æ³•è‡ªåŠ¨è½¬æ¢ï¼Œä½†å¸¸è§çš„ç®€å•è¡¨è¾¾å¼éƒ½èƒ½æˆåŠŸè½¬æ¢ã€‚

---

## ðŸš€ ç³»ç»ŸçŠ¶æ€

### å·²å®žçŽ°çš„åŠŸèƒ½

1. âœ… **ASTé€»è¾‘è½¬æ¢å™¨** (`logic_adapter.py`)
   - Pythonè¡¨è¾¾å¼ â†’ JSONLogicè½¬æ¢
   - è‡ªåŠ¨é›†æˆåˆ°è’¸é¦æµç¨‹
   - é”™è¯¯å¤„ç†å®Œå–„

2. âœ… **è‡ªåŠ¨è½¬æ¢é›†æˆ**
   - åœ¨`parse_llm_response`ä¸­è‡ªåŠ¨æ£€æµ‹å­—ç¬¦ä¸²æ ¼å¼
   - è‡ªåŠ¨è°ƒç”¨è½¬æ¢å™¨
   - æ— ç¼é›†æˆï¼Œæ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç 

3. âœ… **éªŒè¯é€šè¿‡**
   - è½¬æ¢åŽçš„æ ¼å¼é€šè¿‡éªŒè¯å™¨æ£€æŸ¥
   - ç¬¦åˆJSONLogicæ ‡å‡†
   - å¯ä»¥ç›´æŽ¥ç”¨äºŽåŽç»­å¤„ç†

---

## ðŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯ä»¥åšçš„

1. **æµ‹è¯•æ‰¹é‡å¤„ç†**
   ```bash
   source venv/bin/activate
   python kms/scripts/batch_processor.py \
     kms/data/raw_texts/zpzq_shishen.txt \
     --book "å­å¹³çœŸè¯ " \
     --topic "é£Ÿç¥žæ ¼"
   ```

2. **æ‰©å±•è½¬æ¢å™¨**ï¼ˆå¯é€‰ï¼‰
   - æ·»åŠ å‡½æ•°è°ƒç”¨çš„å¤„ç†ï¼ˆå¦‚`exist()` â†’ `{"var": "..."}`ï¼‰
   - å¤„ç†æ›´å¤æ‚çš„è¡¨è¾¾å¼

3. **æ”¶é›†ç»Ÿè®¡**
   - æµ‹è¯•æ›´å¤šæ ·æœ¬
   - ç»Ÿè®¡è½¬æ¢æˆåŠŸçŽ‡
   - è¯†åˆ«å¸¸è§æ¨¡å¼

---

## ðŸŽŠ æ€»ç»“

**è½¬æ¢å™¨é›†æˆ**: âœ… **æˆåŠŸ**

- âœ… æ ¸å¿ƒåŠŸèƒ½å®žçŽ°
- âœ… é›†æˆåˆ°è’¸é¦æµç¨‹
- âœ… å®žé™…æµ‹è¯•é€šè¿‡
- âš ï¸ éƒ¨åˆ†å¤æ‚è¡¨è¾¾å¼éœ€è¦æ‰©å±•

**ç³»ç»Ÿèƒ½åŠ›**: ðŸŸ¢ **æ˜¾è‘—æå‡**

- å¯ä»¥å¤„ç†å°æ¨¡åž‹è¾“å‡ºçš„Pythonè¡¨è¾¾å¼æ ¼å¼
- è‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†JSONLogicæ ¼å¼
- æé«˜ç³»ç»Ÿé²æ£’æ€§å’Œå®žç”¨æ€§

---

**æŠ¥å‘Šæ—¥æœŸ**: 2026-01-03  
**çŠ¶æ€**: âœ… **è½¬æ¢å™¨é›†æˆæˆåŠŸï¼Œç³»ç»Ÿèƒ½åŠ›æå‡**

