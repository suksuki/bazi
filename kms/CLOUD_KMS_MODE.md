# 云端KMS模式 (Cloud-Based KMS)

**模式说明**: 使用云端AI（如Claude/Gemini/GPT-4）直接生成符合FDS-KMS规范的pattern_manifest.json，跳过本地LLM的语义蒸馏环节。

---

## 🎯 模式优势

### 1. 高效性
- ✅ 无需等待本地LLM处理
- ✅ 无需处理JSON截断问题
- ✅ 直接获得符合规范的输出

### 2. 质量保证
- ✅ 云端AI模型（如Claude/Gemini）能力更强
- ✅ 输出格式稳定可靠
- ✅ 符合FDS-KMS规范要求

### 3. 成本效益
- ✅ 避免本地模型的不稳定性
- ✅ 减少调试时间
- ✅ 快速迭代和验证

---

## 🔄 工作流程对比

### 传统模式（本地LLM）

```
古籍文本 → 本地LLM蒸馏 → JSON解析 → 格式转换 → 验证 → pattern_manifest.json
          ⚠️ 可能截断    ⚠️ 可能失败  ⚠️ 需要转换
```

### 云端KMS模式

```
古籍检索 → 云端AI生成 → pattern_manifest.json
                        ✅ 直接可用
```

---

## 📋 使用指南

### 步骤1: 提供上下文

向云端AI提供以下信息：
- FDS-KMS规范文档
- 目标格局名称
- 相关古籍引用

### 步骤2: 请求生成

明确要求：
- 生成符合FDS-KMS V1.0-RC2规范的pattern_manifest.json
- 包含完整的classical_logic_rules（JSONLogic格式）
- 包含完整的tensor_mapping_matrix
- 标记strong_correlation

### 步骤3: 验证和使用

1. 验证JSON格式
2. 运行SOP模拟器验证
3. 集成到系统使用

---

## 📝 示例

### 已生成的配置文件

- ✅ `pattern_manifest_eating_god.json` - 食神格配置
  - 基于《子平真诠》和《三命通会》
  - 包含完整的逻辑规则和物理映射
  - 符合FDS-KMS V1.0-RC2规范

---

## 🎯 适用场景

### 推荐使用云端KMS的场景

1. **快速原型验证**
   - 需要快速测试系统功能
   - 验证SOP引擎是否正确

2. **关键格局配置**
   - 重要格局需要高质量配置
   - 需要确保逻辑正确性

3. **批量生成**
   - 大量格局需要配置
   - 本地LLM不稳定时

### 推荐使用本地KMS的场景

1. **大规模批量处理**
   - 处理大量古籍文本
   - 成本敏感的场景

2. **实时处理**
   - 需要实时响应的场景
   - 不依赖外部服务

---

## 💡 最佳实践

### 混合模式（推荐）

1. **关键格局**: 使用云端KMS，确保质量
2. **批量处理**: 使用本地KMS，降低成本
3. **质量校验**: 混合使用，互相验证

### 质量控制

- ✅ 所有生成的配置文件都经过JSON格式验证
- ✅ 运行SOP模拟器验证逻辑正确性
- ✅ 对比云端和本地生成的结果

---

## 🔧 集成方式

### 直接使用

```bash
# 使用云端生成的配置文件
cp kms/data/pattern_manifest_eating_god.json pattern_manifest.json

# 运行SOP模拟器
python kms/scripts/sop_dry_run.py
```

### 批量集成

可以将云端生成的配置文件直接放入SOP工作流，无需修改代码。

---

## 📊 模式对比

| 特性 | 云端KMS | 本地KMS |
| :--- | :--- | :--- |
| 输出质量 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 处理速度 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 成本 | 💰💰 | 💰 |
| 稳定性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 可控性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

---

## 🎊 总结

**云端KMS模式是传统模式的有力补充**，特别适合：
- 快速验证和原型开发
- 关键格局的高质量配置
- 混合使用策略

**建议**: 在系统建设中，采用混合模式，关键格局使用云端KMS，批量处理使用本地KMS。

---

**文档版本**: V1.0  
**创建日期**: 2026-01-03

