# FDS-KMS 优化路线图

**版本**: V1.0-BETA → V1.0  
**日期**: 2026-01-03

---

## 🎯 优化目标

从BETA版本（核心架构完成）到1.0版本（生产就绪）

---

## 📋 优化清单

### 1. 立即优化（可立即执行）

#### 1.1 配置优化

**文件**: `kms/scripts/batch_processor.py`, `kms/scripts/llm_distill_example.py`

**修改**:
```python
options={
    'num_ctx': 4096,      # 扩大上下文窗口
    'num_predict': 2048,  # 增加输出上限至2048 tokens
    'temperature': 0.1
}
```

**预期效果**: 批量处理成功率从20%提升至80%+

**优先级**: 🔴 P0 (立即执行)

---

#### 1.2 模型升级（如果硬件允许）

**操作**: 
```bash
ollama pull qwen2.5:7b
```

**修改**: `MODEL_NAME = "qwen2.5:7b"`

**预期效果**: 
- 批量处理成功率提升至95%+
- 输出质量显著提升
- 格式错误率降低

**硬件要求**: 8GB+ 内存/显存

**优先级**: 🟡 P1 (推荐)

---

### 2. Phase 4: 数据战役

#### 2.1 数据准备

**任务**:
- [ ] 下载《子平真诠》全文
- [ ] 下载《三命通会》全文
- [ ] 下载《滴天髓》全文
- [ ] 文本清理和格式化

**优先级**: 🟢 P2

---

#### 2.2 批量处理

**任务**:
- [ ] 使用优化配置运行批量处理
- [ ] 处理所有古籍章节
- [ ] 建立1000+条codex条目

**工具**: `kms/scripts/batch_processor.py`

**优先级**: 🟢 P2

---

#### 2.3 质量保证

**任务**:
- [ ] 人工校验关键条目
- [ ] 建立黄金数据集
- [ ] 质量评分机制
- [ ] 错误样本分析

**优先级**: 🟡 P1

---

### 3. Phase 5: 稳定性优化

#### 3.1 错误恢复机制

**任务**:
- [ ] 实现自动重试逻辑（最多3次）
- [ ] 失败样本收集和分析
- [ ] 错误报告系统
- [ ] 失败原因分类

**优先级**: 🟡 P1

---

#### 3.2 性能优化

**任务**:
- [ ] 并发处理（如果显存允许）
- [ ] 缓存机制（Embedding模型、Prompt等）
- [ ] 批量优化（减少API调用）
- [ ] 性能监控和指标收集

**优先级**: 🟢 P2

---

#### 3.3 监控和日志

**任务**:
- [ ] 处理状态监控
- [ ] 性能指标收集
- [ ] 日志系统
- [ ] 错误报警机制

**优先级**: 🟢 P2

---

### 4. Phase 6: 前端可视化（可选）

#### 4.1 基础UI

**功能**:
- [ ] 输入八字界面
- [ ] 结果显示界面
- [ ] 古籍引证展示
- [ ] 配置可视化

**技术栈**: Streamlit 或 Gradio

**优先级**: 🔵 P3 (可选)

---

#### 4.2 高级功能

**功能**:
- [ ] 批量查询
- [ ] 结果导出
- [ ] 可视化分析
- [ ] 配置管理界面

**优先级**: 🔵 P3 (可选)

---

## 📊 优先级矩阵

| 优先级 | 标识 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| P0 | 🔴 | 立即执行，阻塞性问题 | 配置优化 |
| P1 | 🟡 | 高优先级，建议执行 | 模型升级、错误恢复 |
| P2 | 🟢 | 中优先级，有时间就做 | 数据战役、性能优化 |
| P3 | 🔵 | 低优先级，可选功能 | 前端可视化 |

---

## 🎯 成功标准

### V1.0 发布标准

- [ ] 批量处理成功率 ≥ 95%
- [ ] 包含1000+条codex条目
- [ ] 错误恢复机制完善
- [ ] 性能监控到位
- [ ] 文档完整更新

---

## 📝 执行建议

### 第一步：立即优化配置

修改Ollama配置，将`num_predict`提升至2048，测试批量处理成功率。

### 第二步：评估模型升级

如果有硬件条件，升级到qwen2.5:7b，测试效果。

### 第三步：开始数据战役

使用优化后的配置，开始批量处理古籍文本。

### 第四步：持续优化

根据实际使用情况，持续优化和改进。

---

**路线图版本**: V1.0  
**最后更新**: 2026-01-03

