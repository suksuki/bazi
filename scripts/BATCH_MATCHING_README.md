# æ‰¹é‡æ ¼å±€åŒ¹é…å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬å·¥å…·åŒ…å«ä¸¤ä¸ªè„šæœ¬ï¼Œç”¨äºå¯¹å¤§è§„æ¨¡æ ·æœ¬ï¼ˆå¦‚ 51.8 ä¸‡ï¼‰è¿›è¡Œæ ¼å±€åŒ¹é…åˆ†æï¼š

1. **`benchmark_pattern_matching.py`** - æ€§èƒ½æµ‹è¯•å·¥å…·
2. **`batch_pattern_matcher.py`** - æ‰¹é‡åŒ¹é…å·¥å…·ï¼ˆæ”¯æŒå¹¶è¡Œï¼‰

---

## ğŸ”¬ 1. æ€§èƒ½æµ‹è¯•å·¥å…·

### ç”¨é€”
å¿«é€Ÿä¼°ç®—å¤„ç†å¤§è§„æ¨¡æ ·æœ¬æ‰€éœ€çš„æ—¶é—´ã€‚

### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³•ï¼ˆæµ‹è¯• 100 ä¸ªæ ·æœ¬ï¼‰
python3 scripts/benchmark_pattern_matching.py --pattern A-03 --samples 100

# æŒ‡å®šæ•°æ®æ–‡ä»¶ï¼ˆæµ‹è¯•æ–‡ä»¶I/Oæ€§èƒ½ï¼‰
python3 scripts/benchmark_pattern_matching.py \
    --pattern A-03 \
    --samples 100 \
    --data-file core/data/holographic_universe_518k.jsonl

# ä¼°ç®— 51.8 ä¸‡æ ·æœ¬çš„è€—æ—¶
python3 scripts/benchmark_pattern_matching.py \
    --pattern A-03 \
    --samples 100 \
    --total 518000
```

### è¾“å‡ºç¤ºä¾‹

```
ğŸ“Š æ€§èƒ½ç»Ÿè®¡ç»“æœ
å¹³å‡è€—æ—¶: 3.22 ms/æ ·æœ¬

ğŸ”® ä¼°ç®—ï¼šå¯¹ 518,000 ä¸ªæ ·æœ¬çš„å®Œæ•´è¿è¡Œæ—¶é—´
ä»…è®¡ç®—æ—¶é—´: 27.79 åˆ†é’Ÿ
åŒ…å«æ–‡ä»¶I/O: çº¦ 30-40 åˆ†é’Ÿ
```

---

## ğŸš€ 2. æ‰¹é‡åŒ¹é…å·¥å…·ï¼ˆæ¨èï¼‰

### ç”¨é€”
å¯¹å¤§è§„æ¨¡æ ·æœ¬è¿›è¡Œå®Œæ•´çš„æ ¼å±€åŒ¹é…åˆ†æï¼Œæ”¯æŒå¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†ã€‚

### åŸºæœ¬ç”¨æ³•

#### æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èå…ˆç”¨è¿™ä¸ªï¼‰

```bash
# å•è¿›ç¨‹ï¼Œä»…å¤„ç† 1000 ä¸ªæ ·æœ¬ï¼ˆç”¨äºæµ‹è¯•ï¼‰
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl \
    --workers 1 \
    --limit 1000
```

#### å®Œæ•´è¿è¡Œ

```bash
# å¤šè¿›ç¨‹æ¨¡å¼ï¼ˆ8ä¸ªè¿›ç¨‹ï¼‰
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl \
    --workers 8

# è‡ªåŠ¨ä½¿ç”¨ CPU æ ¸å¿ƒæ•°
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl
```

#### è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„

```bash
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl \
    --output results/my_custom_results.json \
    --workers 8
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--pattern` | æ ¼å±€IDï¼ˆå¿…éœ€ï¼‰ | - |
| `--data-file` | æ•°æ®æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰ | - |
| `--workers` | å¹¶è¡Œè¿›ç¨‹æ•° | CPUæ ¸å¿ƒæ•° |
| `--limit` | é™åˆ¶å¤„ç†çš„æ ·æœ¬æ•° | æ— é™åˆ¶ |
| `--batch-size` | æ¯æ‰¹å¤„ç†çš„æ ·æœ¬æ•° | 1000 |
| `--output` | è¾“å‡ºæ–‡ä»¶è·¯å¾„ | `results/{pattern}_match.json` |

### è¾“å‡ºæ–‡ä»¶

è„šæœ¬ä¼šåœ¨ `results/` ç›®å½•ä¸‹ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ï¼š

1. **`{pattern}_match.stats.json`** - ç»Ÿè®¡ä¿¡æ¯
   ```json
   {
     "total_samples": 518000,
     "success_count": 517500,
     "matched_count": 12500,
     "match_rate": 2.42,
     "avg_precision": 0.45,
     "total_time_min": 4.2,
     ...
   }
   ```

2. **`{pattern}_match.matched.json`** - åŒ¹é…çš„æ ·æœ¬è¯¦æƒ…ï¼ˆPrecision > 0.6ï¼‰
   ```json
   {
     "matched_count": 12500,
     "results": [
       {
         "uid": 12345,
         "precision_score": 0.8234,
         "mahalanobis_dist": 1.23,
         "tensor": {...}
       },
       ...
     ]
   }
   ```

3. **`{pattern}_match.errors.json`** - é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰

### æ€§èƒ½é¢„æœŸ

åŸºäºæµ‹è¯•ç»“æœï¼ˆå•æ ·æœ¬å¹³å‡ 3.22msï¼‰ï¼š

| æ ·æœ¬æ•° | å•è¿›ç¨‹ | 4è¿›ç¨‹ | 8è¿›ç¨‹ | 16è¿›ç¨‹ |
|--------|--------|-------|-------|--------|
| 1,000 | 3.2ç§’ | 1.0ç§’ | 0.6ç§’ | 0.4ç§’ |
| 10,000 | 32ç§’ | 10ç§’ | 6ç§’ | 4ç§’ |
| 100,000 | 5.4åˆ†é’Ÿ | 1.7åˆ†é’Ÿ | 1.0åˆ†é’Ÿ | 0.7åˆ†é’Ÿ |
| 518,000 | 28åˆ†é’Ÿ | 9åˆ†é’Ÿ | **5-6åˆ†é’Ÿ** | 4åˆ†é’Ÿ |

**æ³¨æ„**: å®é™…æ€§èƒ½å–å†³äºï¼š
- CPUæ ¸å¿ƒæ•°å’Œæ€§èƒ½
- ç£ç›˜I/Oé€Ÿåº¦
- å†…å­˜å®¹é‡
- æ•°æ®æ–‡ä»¶æ ¼å¼

---

## ğŸ“Š 3. ç»“æœåˆ†æ

### å…³é”®æŒ‡æ ‡

1. **åŒ¹é…ç‡ (Match Rate)**
   - `precision_score > 0.6`: ä¸€èˆ¬åŒ¹é…
   - `precision_score > 0.8`: å¼ºåŒ¹é…

2. **ç²¾ç¡®åº¦åˆ†å¸ƒ**
   - `0.0-0.2`: å®Œå…¨ä¸åŒ¹é…
   - `0.2-0.4`: å¼±åŒ¹é…
   - `0.4-0.6`: è¾¹ç¼˜åŒ¹é…
   - `0.6-0.8`: è‰¯å¥½åŒ¹é…
   - `0.8-1.0`: å¼ºåŒ¹é…

3. **å¤„ç†é€Ÿåº¦**
   - æ ·æœ¬/ç§’ï¼šæ¯ç§’å¤„ç†çš„æ ·æœ¬æ•°
   - ç”¨äºä¼°ç®—å¤§è§„æ¨¡å¤„ç†çš„æ—¶é—´

### ç¤ºä¾‹è¾“å‡º

```
ğŸ“Š å¤„ç†ç»“æœç»Ÿè®¡
æ€»æ ·æœ¬æ•°: 518,000
æˆåŠŸå¤„ç†: 517,500
å¤„ç†å¤±è´¥: 500

åŒ¹é…ç»Ÿè®¡:
  åŒ¹é…æ ·æœ¬ (Precision > 0.6): 12,500 (2.42%)
  å¼ºåŒ¹é… (Precision > 0.8): 3,200 (0.62%)

ç²¾ç¡®åº¦åˆ†å¸ƒ:
  0.0-0.2: 450,000 (87.0%)
  0.2-0.4: 45,000 (8.7%)
  0.4-0.6: 10,000 (1.9%)
  0.6-0.8: 9,300 (1.8%)
  0.8-1.0: 3,200 (0.6%)

æ€§èƒ½ç»Ÿè®¡:
  å¹³å‡ç²¾ç¡®åº¦: 0.4523
  ä¸­ä½æ•°ç²¾ç¡®åº¦: 0.2100
  æ€»è€—æ—¶: 5.2 åˆ†é’Ÿ
  å¤„ç†é€Ÿåº¦: 1,658.3 æ ·æœ¬/ç§’
```

---

## ğŸ¯ 4. ä½¿ç”¨å»ºè®®

### é¦–æ¬¡ä½¿ç”¨

1. **å…ˆè¿è¡Œæ€§èƒ½æµ‹è¯•**
   ```bash
   python3 scripts/benchmark_pattern_matching.py --pattern A-03 --samples 100
   ```

2. **å°è§„æ¨¡æµ‹è¯•**
   ```bash
   python3 scripts/batch_pattern_matcher.py \
       --pattern A-03 \
       --data-file core/data/holographic_universe_518k.jsonl \
       --workers 1 \
       --limit 1000
   ```

3. **æ£€æŸ¥ç»“æœ**
   - æŸ¥çœ‹ `results/A-03_match.stats.json`
   - éªŒè¯åŒ¹é…ç‡æ˜¯å¦åˆç†
   - æ£€æŸ¥æ˜¯å¦æœ‰å¤§é‡é”™è¯¯

4. **å®Œæ•´è¿è¡Œ**
   ```bash
   python3 scripts/batch_pattern_matcher.py \
       --pattern A-03 \
       --data-file core/data/holographic_universe_518k.jsonl \
       --workers 8
   ```

### ä¼˜åŒ–å»ºè®®

1. **è¿›ç¨‹æ•°è®¾ç½®**
   - å»ºè®®ä½¿ç”¨ CPU æ ¸å¿ƒæ•°çš„ 80-100%
   - ä¾‹å¦‚ï¼š8æ ¸CPU â†’ ä½¿ç”¨ 6-8 ä¸ªè¿›ç¨‹

2. **æ‰¹æ¬¡å¤§å°**
   - å†…å­˜å……è¶³ï¼š1000-5000
   - å†…å­˜å—é™ï¼š500-1000

3. **ç›‘æ§èµ„æº**
   - ä½¿ç”¨ `htop` ç›‘æ§CPUå’Œå†…å­˜
   - ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆç»“æœæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼‰

---

## âš ï¸ 5. æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**
   - æ¯ä¸ªè¿›ç¨‹çº¦å ç”¨ 100-200MB
   - 51.8ä¸‡æ ·æœ¬çš„å¤„ç†ç»“æœå¯èƒ½å ç”¨æ•°GBå†…å­˜

2. **ç£ç›˜ç©ºé—´**
   - åŒ¹é…ç»“æœæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼ˆæ•°GBï¼‰
   - ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

3. **æ•°æ®æ ¼å¼**
   - è„šæœ¬å‡è®¾ JSONL æ ¼å¼
   - æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡
   - å¿…é¡»åŒ…å« `chart` æˆ– `tensor` å­—æ®µ

4. **é”™è¯¯å¤„ç†**
   - å•ä¸ªæ ·æœ¬å¤±è´¥ä¸ä¼šä¸­æ–­æ•´ä¸ªæµç¨‹
   - é”™è¯¯ä¿¡æ¯ä¿å­˜åœ¨ `.errors.json` æ–‡ä»¶ä¸­

---

## ğŸ› 6. æ•…éšœæ’é™¤

### é—®é¢˜ï¼šå¤„ç†é€Ÿåº¦å¾ˆæ…¢

- **æ£€æŸ¥è¿›ç¨‹æ•°**: ç¡®ä¿ä½¿ç”¨äº†å¤šä¸ªè¿›ç¨‹
- **æ£€æŸ¥I/O**: æ•°æ®æ–‡ä»¶æ˜¯å¦åœ¨SSDä¸Š
- **å‡å°‘æ‰¹æ¬¡å¤§å°**: å°è¯• `--batch-size 500`

### é—®é¢˜ï¼šå†…å­˜ä¸è¶³

- **å‡å°‘è¿›ç¨‹æ•°**: ä½¿ç”¨ `--workers 4` è€Œä¸æ˜¯ 8
- **å‡å°‘æ‰¹æ¬¡å¤§å°**: ä½¿ç”¨ `--batch-size 500`

### é—®é¢˜ï¼šå¤§é‡é”™è¯¯

- **æ£€æŸ¥æ•°æ®æ ¼å¼**: ç¡®è®¤ JSONL æ ¼å¼æ­£ç¡®
- **æ£€æŸ¥å¿…éœ€å­—æ®µ**: ç¡®è®¤åŒ…å« `chart` æˆ– `tensor` å­—æ®µ
- **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**: `results/{pattern}_match.errors.json`

---

## ğŸ“ 7. ç¤ºä¾‹å·¥ä½œæµ

### å®Œæ•´çš„ A-03 æ ¼å±€åŒ¹é…åˆ†æ

```bash
# æ­¥éª¤1: æ€§èƒ½æµ‹è¯•
python3 scripts/benchmark_pattern_matching.py \
    --pattern A-03 \
    --samples 100 \
    --total 518000

# æ­¥éª¤2: å°è§„æ¨¡æµ‹è¯•ï¼ˆ1000æ ·æœ¬ï¼‰
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl \
    --workers 1 \
    --limit 1000 \
    --output results/a03_test.json

# æ­¥éª¤3: æ£€æŸ¥æµ‹è¯•ç»“æœ
cat results/a03_test.stats.json

# æ­¥éª¤4: å®Œæ•´è¿è¡Œ
python3 scripts/batch_pattern_matcher.py \
    --pattern A-03 \
    --data-file core/data/holographic_universe_518k.jsonl \
    --workers 8 \
    --output results/a03_full_match.json

# æ­¥éª¤5: åˆ†æç»“æœ
cat results/a03_full_match.stats.json
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- `FDS_MODELING_SPEC_v3.0.md` - FDS-V3.0 å»ºæ¨¡è§„èŒƒ
- `QGA_HR_REGISTRY_SPEC_v3.0.md` - æ³¨å†Œè¡¨è§„èŒƒ
- `run_fds_v3_grand_slam.py` - æ­£å‘æ‹Ÿåˆè„šæœ¬

